import{r as o,j as e,m as v,D as U,a as N,C as J,b as G,c as B,R as K,d as W}from"./vendor-DtswYIs6.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&t(h)}).observe(document,{childList:!0,subtree:!0});function c(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(r){if(r.ep)return;r.ep=!0;const l=c(r);fetch(r.href,l)}})();const T=o.createContext();function Q({children:n}){const[s,c]=o.useState([]),[t,r]=o.useState(!0);return o.useEffect(()=>{async function l(){try{const d=await(await fetch("/api/data")).json();c(JSON.parse(d))}catch(h){console.error("Failed to fetch members",h)}finally{r(!1)}}l()},[]),e.jsx(T.Provider,{value:{members:s,isLoading:t},children:n})}const X="_memberCard_1uz18_1",q="_memberTitle_1uz18_13",Z="_cardContainer_1uz18_23",ee="_memberCardFull_1uz18_63",R={memberCard:X,memberTitle:q,cardContainer:Z,memberCardFull:ee};function te({memberId:n,fields:s}){return e.jsxs("div",{className:R.memberCard,children:[e.jsxs(v.Link,{to:`/app/members/${n}`,state:{memberFields:s},className:R.memberTitle,children:[e.jsxs("span",{children:[s.first_name," "]})," ",e.jsx("span",{children:s.last_name})," ",e.jsxs("span",{children:[" - ",s.membership_status]})]}),e.jsxs("div",{children:["Join date: ",s.join_date]}),e.jsxs("div",{children:["Expiry date: ",s.xdate]}),e.jsxs("div",{children:["Email: ",s.email]}),e.jsxs("div",{children:["Address: ",s.address1," ",s.address2,", ",s.city," ",s.state," ",s.vaccinated]})]})}const se="_fullPage_7eejv_1",ne="_searchBar_7eejv_13",re="_inactive_7eejv_33",ae="_active_7eejv_41",ie="_buttonsContainer_7eejv_49",oe="_toggleAdvancedSearch_7eejv_59",ce="_filterSideBar_7eejv_71",le="_content_7eejv_89",de="_membersList_7eejv_113",D={fullPage:se,searchBar:ne,inactive:re,active:ae,buttonsContainer:ie,toggleAdvancedSearch:oe,filterSideBar:ce,content:le,membersList:de};function ue({name:n,setQuery:s}){function c(t){return t==="address1"?"Address: ":t.charAt(0).toUpperCase()+t.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:D.filterField,children:[e.jsx("label",{children:`${c(n)}`}),e.jsx("input",{id:`adv_${n}`,type:"text",onChange:t=>s(n,t.target.value)})]})}function L({name:n,selectOptions:s=[],setQuery:c}){function t(r){return r==="student_yes_no"?"Student?: ":r.charAt(0).toUpperCase()+r.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:D.filterField,children:[e.jsx("label",{children:`${t(n)}`}),e.jsx("select",{id:`adv_${n}`,name:`adv_${n}`,onChange:r=>c(n,r.target.value),children:s.map(r=>e.jsx("option",{value:r,children:r},`adv_${r}`))})]})}function E({name:n,setQuery:s,resetDates:c,defaultDate:t,datesRange:r}){const[l,h]=o.useState(t||new Date),[d,m]=o.useState([]),[j,_]=o.useState(!1);function g(i){return i==="xdate_before"?"Membership expires before: ":i=="xdate_after"?"Membership expires after: ":i==="join_date_after"?"Joined after: ":i==="join_date_before"?"Joined before: ":i.charAt(0).toUpperCase()+i.slice(1).replaceAll("_"," ")+": "}function y(i,b){h(b),s(i,b),_(!0)}o.useEffect(()=>{h(new Date),_(!1)},[c]),o.useEffect(()=>{d.length===0&&r!==void 0&&m(C(r))},[r]);function C(i){return i.map(b=>typeof b=="string"?p(b):b)}function p(i){return new Date(i.replace("-","/"))}o.useEffect(()=>{if(t){let i=t;typeof t=="string"&&(i=p(i),y(n,i)),h(i)}},[t]);function a(){_(!0)}return e.jsxs("div",{children:[e.jsx("label",{children:`${g(n)}`}),e.jsx(U,{className:j?D.active:D.inactive,selected:l,onChange:i=>y(n,i),onCalendarOpen:a,includeDateIntervals:r?[{start:d[0],end:d[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const he="_redButton_ta6ja_101",me="_whiteButton_ta6ja_119",w={redButton:he,whiteButton:me};function fe({setStateParameters:n,isVisible:s}){const[c,t]=o.useState({}),[r,l]=o.useState(!1),h=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],d=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],m=["join_date_before","join_date_after","xdate_before","xdate_after"],j=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],_=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],g=["","Member","Member in Good Standing","Lapsed"];function y(a,i){i=i.toString().toLowerCase(),a==="union_member"&&(i=i==="true"?"yes":"no"),t(b=>({...b,[a]:i}))}function C(a){a.preventDefault(),n(c)}function p(){document.querySelector("#advancedFilterForm").reset(),t({}),n({}),l(a=>!a)}return e.jsx("aside",{className:D.filterSideBar,children:s&&e.jsxs("form",{id:"advancedFilterForm",style:{display:s?"block":"none"},onSubmit:a=>C(a),children:[h.map(a=>d.includes(a)?e.jsx(ue,{name:a,setQuery:y},`component_${a}`):j.includes(a)?e.jsx(L,{name:a,selectOptions:["","True","False"],setQuery:y},`component_${a}`):m.includes(a)?e.jsx(E,{name:a,setQuery:y,resetDates:r,setResetDates:l},`component_${a}_${r}`):a==="membership_status"?e.jsx(L,{name:a,selectOptions:g,setQuery:y},`component_${a}`):a==="student_yes_no"?e.jsx(L,{name:a,selectOptions:["","Yes","No"],setQuery:y},`component_${a}`):a==="mailing_pref"?e.jsx(L,{name:a,selectOptions:["","Yes","No"],setQuery:y},`component_${a}`):a==="state"?e.jsx(L,{name:a,selectOptions:_,setQuery:y},`component_${a}`):console.log("unrecognized field; how'd you manage this?")),e.jsxs("div",{className:D.buttonsContainer,children:[e.jsx("button",{onClick:C,className:w.redButton,children:"Search"}),e.jsx("button",{onClick:p,className:w.whiteButton,children:"Clear filters"})]})]})})}const pe="_Search_6hey7_1",_e="_searchForm_6hey7_9",xe="_searchButton_6hey7_19",O={Search:pe,searchForm:_e,searchButton:xe};function je({setStateParameters:n,query:s,setQuery:c,setReRender:t,reRender:r}){function l(h){h.preventDefault();const d={};if(n({}),s.includes(":")){const m=s.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(m);for(let j=0;j<m.length-1;j+=2){const _=m[j],g=m[j+1];d[_]=g}n(d)}t(!r)}return e.jsxs("form",{className:O.searchForm,onSubmit:h=>l(h),children:[e.jsx("input",{value:s,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:h=>c(h.target.value),type:"text",className:O.Search}),e.jsx("button",{className:`${w.redButton} ${O.searchButton}`,children:"Go!"})]})}function be({MemberList:n=[]}){const[s,c]=o.useState(""),[t,r]=o.useState({}),[l,h]=o.useState(!1),[d,m]=o.useState(!1),j=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],_=()=>{m(p=>!p)},g=n.filter(p=>{const a=p.fields;let i={...t};const b=Object.keys(i).length;if(!b&&s!==""){for(const u in a){const f=a[u];if(f&&f.toString().toLowerCase().includes(s.toLowerCase()))return!0}return!1}else{if(!b&&s==="")return!0;if(b>0){if(j.some(({before:f,after:x})=>f in i||x in i)&&!C(a,i)||i.address1&&!y(a,i))return!1;for(const f of Object.keys(i)){const x=i[f];if(!(a[f]!==null?a[f].toString().toLowerCase():"").includes(x))return!1}return!0}}});function y(p,a){return!!(p.address1.includes(a.address1)||p.address2.includes(a.address1))}function C(p,a){let i=!0;for(const{base:b,before:u,after:f}of j){const x=a[u],S=a[f];x&&S?i=i&&N(p[b]).isBetween(a[f],a[u]):x?i=i&&N(p[b]).isBefore(a[u]):S&&(i=i&&N(p[b]).isAfter(a[f])),x&&delete a[u],S&&delete a[f]}return i}return e.jsxs("div",{className:D.fullPage,children:[e.jsxs("header",{className:D.searchBar,children:[e.jsx(je,{setStateParameters:r,query:s,setQuery:c,setReRender:h,reRender:l}),e.jsxs("a",{className:D.toggleAdvancedSearch,onClick:_,children:[d?"Close":"Open"," advanced search"]})]}),e.jsxs("div",{className:D.content,children:[e.jsx(fe,{setStateParameters:r,isVisible:d}),e.jsx("main",{className:D.membersList,children:g.length>0?g.map(p=>e.jsx(te,{memberId:p.pk,fields:p.fields},p.pk)):e.jsx("li",{children:"No results found"})},l)]})]})}const ge="_logoHeader_1iozh_1",ve={logoHeader:ge},ye="/static/react/headerlogo-400x400-vDrkEIdg.png";function z(){return e.jsxs("header",{className:ve.logoHeader,children:[e.jsx("img",{src:ye}),e.jsxs("h2",{children:["DSA ",e.jsx("br",{}),"Membership",e.jsx("br",{}),"Visualizer"]})]})}const Ce="_navBar_1cdgm_1",Se="_pageOptions_1cdgm_27",I={navBar:Ce,pageOptions:Se};function De(){return e.jsxs("nav",{className:I.navBar,children:[e.jsx(z,{}),e.jsxs("div",{className:I.pageOptions,children:[e.jsx("a",{href:"/admin/",children:"Admin"}),e.jsx(v.Link,{to:"/app/search",children:"Search"}),e.jsx(v.Link,{to:"/app/statistics",children:"Statistics"}),e.jsx(v.Link,{to:"/app/logout",children:"Log out"})]})]})}function Ne(){const{members:n,isLoading:s}=o.useContext(T);return s?e.jsx("p",{children:"Loading members..."}):e.jsx("div",{className:"MembersList",children:e.jsx(be,{MemberList:n})})}function Ae(){return e.jsxs("div",{children:["Page not found. Have you forgotten to log in to the ",e.jsx("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function V({data:n,type:s}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function t(r){const l=r[0].slice(1);let h=r[1],d=r[r.length-1],m=[h,d];const _=[["Metric",...[h[0],d[0]],"% Change"]];return l.forEach((g,y)=>{const C=m.map(S=>S[y+1]),p=C[0],a=C[C.length-1],i=p!==0?(a-p)/Math.abs(p)*100:0,b=i>0?"⬆️":i<0?"⬇️":"—",u=i<0?"red":i>0?"green":"black",f=`${b} <span style="color:${u};">${i.toFixed(2)}%</span>`,x=[g,...C,f];_.push(x)}),_}return!n||!Array.isArray(n)||n.length===0||n[0].length===0?e.jsx("p",{children:"Loading chart data..."}):e.jsx(J,{chartType:s,data:s==="Table"?t(n):n,options:c,legendToggle:!0})}const Fe="_chartContainer_1m3i0_1",Le="_numbersAside_1m3i0_17",Me="_chartForm_1m3i0_29",we="_chartAside_1m3i0_57",ke="_statistics_1m3i0_77",A={chartContainer:Fe,numbersAside:Le,chartForm:Me,chartAside:we,statistics:ke};function Y({asideName:n,dates:s,setDates:c}){const[t,r]=o.useState({});function l(d,m){r(j=>({...j,[d]:m}))}function h(d){d.preventDefault(),c(Object.values(t))}return e.jsxs("form",{className:A.chartForm,children:[e.jsx(E,{name:`${n}_from`,setQuery:l,defaultDate:s[0],datesRange:s}),e.jsx(E,{name:`${n}_to`,setQuery:l,defaultDate:s[1],datesRange:s})," ",e.jsx("button",{className:w.redButton,onClick:d=>h(d),children:"Go!"})]})}function Be(){const[n,s]=o.useState(null),[c,t]=o.useState(null),[r,l]=o.useState(null),[h,d]=o.useState(!0),[m,j]=o.useState([]),[_,g]=o.useState([]),[y,C]=o.useState([]),p=[];o.useEffect(()=>{async function u(){try{const x=await(await fetch("/api/membership_counts/")).json();s(x)}catch(f){console.error("Failed to fetch membershipCount",f)}finally{d(!1)}}u()},[]);function a(u){if(u.splice(2,1),u.splice(0,1),typeof u[1]=="string")for(let f=0;f<u.length;f++)u[f]=u[f].charAt(0).toUpperCase()+u[f].slice(1).replaceAll("_"," ");return u}function i(u){var f=u,x=f.sort(function(S,F){return Date.parse(S)>Date.parse(F)});j([x[0],x[x.length-1]]),g([x[0],x[x.length-1]])}o.useEffect(()=>{if(n){let u=Object.keys(n[0]),f=[];u=a(u),p.push(u);for(const x of n)f.push(x.list_date),u=Object.values(x),u=a(u),p.push(u);t(p),l(p),i(f)}},[n]),o.useEffect(()=>{m&&c&&b(m,"chart")},[m]),o.useEffect(()=>{_&&c&&b(_,"table")},[_]);function b(u,f){if(!u||Object.keys(u).length!==2||!c)return;const x=N(u[0]).format("YYYY-MM-DD"),S=N(u[1]).format("YYYY-MM-DD");let F=[c[0]];for(let k=1;k<c.length;k++){const $=N(c[k][0]).format("YYYY-MM-DD");(N($).isBetween(x,S)||N($).isSame(x)||N($).isSame(S))&&F.push(c[k])}f==="chart"&&l(F),f==="table"&&C(F)}return n?h?e.jsx("p",{children:"Loading statistics..."}):e.jsxs("main",{className:A.statistics,children:[e.jsxs("aside",{className:A.numbersAside,children:[e.jsx("h2",{children:"Percent Change Over Time"}),e.jsxs("div",{className:A.chartContainer,children:[e.jsx(Y,{dates:_,asideName:"chart",setDates:g}),e.jsx(V,{data:y,type:"Table"})]})]}),e.jsxs("aside",{className:A.chartAside,children:[e.jsx("h2",{children:"Area Chart of Membership Trends"}),e.jsxs("div",{className:A.chartContainer,children:[e.jsx(Y,{dates:m,asideName:"chart",setDates:j}),e.jsx(V,{data:r,type:"AreaChart"})]})]})]}):e.jsx("p",{children:"Membership statistics not found."})}const Re="_error_1tgho_29",$e="_loginPage_1tgho_45",Oe="_loginContainer_1tgho_61",P={error:Re,loginPage:$e,loginContainer:Oe};function H({onLoginSuccess:n}){const[s,c]=o.useState(""),[t,r]=o.useState(""),[l,h]=o.useState(""),d=v.useNavigate(),m=G.get("csrftoken");console.log("hey help lol"+m);const j=async _=>{_.preventDefault();try{const g=await B.post("/api/login/",{username:s,password:t},{headers:{"X-CSRFToken":m},withCredentials:!0});h(null),console.log(g.data.access),d("/app/search"),n(),console.log("navigating")}catch(g){console.error("Login failed:",g);const y=g?.response?.data?.error||g?.response?.data?.detail||g?.message||"Login failed due to an unknown error.";B.defaults.headers.common.Authorization=null,h(y)}};return e.jsx("main",{className:P.loginPage,children:e.jsxs("form",{className:P.loginContainer,onSubmit:j,children:[e.jsxs("div",{className:P.error,style:{display:l?"block":"none"},children:["Error: ",l+"."]}),e.jsx(z,{}),e.jsx("label",{htmlFor:"username",children:"Username: "}),e.jsx("input",{htmlFor:"username",type:"username",onChange:_=>c(_.target.value)}),e.jsx("label",{htmlFor:"password",children:"Password: "}),e.jsx("input",{htmlFor:"password",type:"password",onChange:_=>r(_.target.value)}),e.jsx("button",{className:w.redButton,children:"Log in"})]})})}function Pe({onLogoutSuccess:n}){return localStorage.removeItem("token"),n(),e.jsx(H,{})}function Ee(){const{memberId:n}=v.useParams(),{members:s,isLoading:c}=o.useContext(T),[t,r]=o.useState(null),[l,h]=o.useState(!1);return o.useEffect(()=>{const d=s.find(m=>m.pk.toString()===n);if(d)r(d);else{async function m(){h(!0);try{const _=await(await fetch(`/api/${n}/data`)).json();r(JSON.parse(_))}catch(j){console.error("Failed to fetch member data",j)}finally{h(!1)}}m()}},[n,s]),c||l?e.jsx("p",{children:"Loading member details..."}):t?e.jsx("div",{className:R.cardContainer,children:e.jsxs("div",{className:R.memberCardFull,children:[e.jsxs("h1",{children:[t.fields.first_name," ",t.fields.last_name]}),e.jsxs("section",{for:"committees_and_unions",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Committee:"}),t.fields.committee.length===0?" N/A":t.fields.committee]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union member:"})," ",t.fields.union_member]}),t.fields.union_name===""?e.jsx("span",{}):e.jsxs("p",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Union name:"})," ",t.fields.union_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union local?:"})," ",t.fields.union_local]})]})]}),e.jsxs("section",{for:"contact",children:[e.jsx("h2",{children:"Contact information"}),e.jsxs("div",{children:[e.jsx("b",{children:"Best phone number:"})," ",t.fields.best_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile phone:"})," ",t.fields.mobile_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",t.fields.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord:"})," ",t.fields.discord_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord status:"})," ",t.fields.discord_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mailing address:"})," ",t.fields.address1,","," ",t.fields.city," ",t.fields.zip,", ",t.fields.country]})]}),e.jsxs("section",{for:"membership_info",children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",t.fields.membership_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"DSA Chapter:"})," ",t.fields.dsa_chapter]}),e.jsxs("div",{children:[e.jsx("b",{children:"Membership type:"})," ",t.fields.membership_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Joined in the past month?:"}),t.fields.new_member_past_month]}),e.jsxs("div",{children:[e.jsx("b",{children:"Monthly dues status:"})," ",t.fields.monthly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Yearly dues status:"})," ",t.fields.yearly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Join Date:"})," ",t.fields.join_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Expiry Date:"})," ",t.fields.xdate]})]})]})}):e.jsx("p",{children:"Member not found."})}const Te=async(n,s)=>{try{const c=await B.get("/api/validate-token/",{headers:{Authorization:`Bearer ${n}`},withCredentials:!0});return!0}catch(c){if(c.response?.status===401&&s)try{const t=await B.post("api/validate-refresh-token/",{},{withCredentials:!0});return s(t.data.access),!0}catch{return!1}}},M=({children:n,isValid:s})=>{const c=localStorage.getItem("token");return!c||!s?(c||console.log("no token found"),s||console.log("invalid token"),e.jsx(v.Navigate,{to:"/login"})):n};function Ie(){const[n,s]=o.useState(null),[c,t]=o.useState(null),[r,l]=o.useState(!0);return o.useEffect(()=>{(async()=>{let d=c;if(!d)try{d=(await axios.post("api/validate-refresh-token/",{},{withCredentials:!0})).data.access,t(d)}catch(m){console.log("Token refresh failed:",m.response?.data||m.message)}if(d){const m=await Te(d,t);s(m)}else s(!1);l(!1)})()},[]),r?e.jsx("div",{children:"Checking authentication..."}):e.jsx(v.BrowserRouter,{children:n?e.jsxs(e.Fragment,{children:[e.jsx(De,{}),e.jsx(Q,{children:e.jsxs(v.Routes,{children:[e.jsx(v.Route,{path:"/",element:e.jsx(v.Navigate,{to:"/app/search",replace:!0})}),e.jsx(v.Route,{path:"/app/search",element:e.jsx(M,{isValid:n,children:e.jsx(Ne,{})})}),e.jsx(v.Route,{path:"/app/statistics",element:e.jsx(M,{isValid:n,children:e.jsx(Be,{})})}),e.jsx(v.Route,{path:"/app/members/:memberId",element:e.jsx(M,{isValid:n,children:e.jsx(Ee,{})})}),e.jsx(v.Route,{path:"/app/logout",element:e.jsx(M,{isValid:n,children:e.jsx(Pe,{onLogoutSuccess:()=>s(!1)})})}),e.jsx(v.Route,{path:"*",element:e.jsx(M,{isValid:n,children:e.jsx(Ae,{})})})]})})]}):e.jsxs(v.Routes,{children:[e.jsx(v.Route,{path:"/app/login",element:e.jsx(H,{onLoginSuccess:()=>s(!0)})}),e.jsx(v.Route,{path:"*",element:e.jsx(v.Navigate,{to:"/app/login"})})]})})}K.createRoot(document.getElementById("root")).render(e.jsx(W.StrictMode,{children:e.jsx(Ie,{})}));
