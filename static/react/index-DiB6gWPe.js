import{r as i,j as e,m as C,D as Q,a as F,C as X,b as q,c as $,_ as R,R as Z,d as ee}from"./vendor-Fm9ckxW3.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function c(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=c(a);fetch(a.href,l)}})();const z=i.createContext();function T({children:t}){const[r,c]=i.useState([]),[s,a]=i.useState(!0);return i.useEffect(()=>{async function l(){try{const h=await(await fetch("/api/data")).json();c(JSON.parse(h))}catch(u){console.error("Failed to fetch members",u)}finally{a(!1)}}l()},[]),e.jsx(z.Provider,{value:{members:r,isLoading:s},children:t})}const te="_memberCard_1uz18_1",se="_memberTitle_1uz18_13",ne="_cardContainer_1uz18_23",re="_memberCardFull_1uz18_63",E={memberCard:te,memberTitle:se,cardContainer:ne,memberCardFull:re};function ae({memberId:t,fields:r}){return e.jsxs("div",{className:E.memberCard,children:[e.jsxs(C.Link,{to:`/app/members/${t}`,state:{memberFields:r},className:E.memberTitle,children:[e.jsxs("span",{children:[r.first_name," "]})," ",e.jsx("span",{children:r.last_name})," ",e.jsxs("span",{children:[" - ",r.membership_status]})]}),e.jsxs("div",{children:["Join date: ",r.join_date]}),e.jsxs("div",{children:["Expiry date: ",r.xdate]}),e.jsxs("div",{children:["Email: ",r.email]}),e.jsxs("div",{children:["Address: ",r.address1," ",r.address2,", ",r.city," ",r.state," ",r.vaccinated]})]})}const oe="_fullPage_7eejv_1",ie="_searchBar_7eejv_13",ce="_inactive_7eejv_33",le="_active_7eejv_41",de="_buttonsContainer_7eejv_49",ue="_toggleAdvancedSearch_7eejv_59",he="_filterSideBar_7eejv_71",me="_content_7eejv_89",fe="_membersList_7eejv_113",N={fullPage:oe,searchBar:ie,inactive:ce,active:le,buttonsContainer:de,toggleAdvancedSearch:ue,filterSideBar:he,content:me,membersList:fe};function pe({name:t,setQuery:r}){function c(s){return s==="address1"?"Address: ":s.charAt(0).toUpperCase()+s.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${c(t)}`}),e.jsx("input",{id:`adv_${t}`,type:"text",onChange:s=>r(t,s.target.value)})]})}function k({name:t,selectOptions:r=[],setQuery:c}){function s(a){return a==="student_yes_no"?"Student?: ":a.charAt(0).toUpperCase()+a.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${s(t)}`}),e.jsx("select",{id:`adv_${t}`,name:`adv_${t}`,onChange:a=>c(t,a.target.value),children:r.map(a=>e.jsx("option",{value:a,children:a},`adv_${a}`))})]})}function Y({name:t,setQuery:r,resetDates:c,defaultDate:s,datesRange:a}){const[l,u]=i.useState(s||new Date),[h,d]=i.useState([]),[p,_]=i.useState(!1);function j(o){return o==="xdate_before"?"Membership expires before: ":o=="xdate_after"?"Membership expires after: ":o==="join_date_after"?"Joined after: ":o==="join_date_before"?"Joined before: ":o.charAt(0).toUpperCase()+o.slice(1).replaceAll("_"," ")+": "}function m(o,x){u(x),r(o,x),_(!0)}i.useEffect(()=>{u(new Date),_(!1)},[c]),i.useEffect(()=>{h.length===0&&a!==void 0&&d(b(a))},[a]);function b(o){return o.map(x=>typeof x=="string"?g(x):x)}function g(o){return new Date(o.replace("-","/"))}i.useEffect(()=>{if(s){let o=s;typeof s=="string"&&(o=g(o),m(t,o)),u(o)}},[s]);function n(){_(!0)}return e.jsxs("div",{children:[e.jsx("label",{children:`${j(t)}`}),e.jsx(Q,{className:p?N.active:N.inactive,selected:l,onChange:o=>m(t,o),onCalendarOpen:n,includeDateIntervals:a?[{start:h[0],end:h[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const je="_redButton_ta6ja_101",_e="_whiteButton_ta6ja_119",B={redButton:je,whiteButton:_e};function xe({setStateParameters:t,isVisible:r}){const[c,s]=i.useState({}),[a,l]=i.useState(!1),u=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],h=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],d=["join_date_before","join_date_after","xdate_before","xdate_after"],p=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],_=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],j=["","Member","Member in Good Standing","Lapsed"];function m(n,o){o=o.toString().toLowerCase(),n==="union_member"&&(o=o==="true"?"yes":"no"),s(x=>({...x,[n]:o}))}function b(n){n.preventDefault(),t(c)}function g(){document.querySelector("#advancedFilterForm").reset(),s({}),t({}),l(n=>!n)}return e.jsx("aside",{className:N.filterSideBar,children:r&&e.jsxs("form",{id:"advancedFilterForm",style:{display:r?"block":"none"},onSubmit:n=>b(n),children:[u.map(n=>h.includes(n)?e.jsx(pe,{name:n,setQuery:m},`component_${n}`):p.includes(n)?e.jsx(k,{name:n,selectOptions:["","True","False"],setQuery:m},`component_${n}`):d.includes(n)?e.jsx(Y,{name:n,setQuery:m,resetDates:a,setResetDates:l},`component_${n}_${a}`):n==="membership_status"?e.jsx(k,{name:n,selectOptions:j,setQuery:m},`component_${n}`):n==="student_yes_no"?e.jsx(k,{name:n,selectOptions:["","Yes","No"],setQuery:m},`component_${n}`):n==="mailing_pref"?e.jsx(k,{name:n,selectOptions:["","Yes","No"],setQuery:m},`component_${n}`):n==="state"?e.jsx(k,{name:n,selectOptions:_,setQuery:m},`component_${n}`):console.log("unrecognized field; how'd you manage this?")),e.jsxs("div",{className:N.buttonsContainer,children:[e.jsx("button",{onClick:b,className:B.redButton,children:"Search"}),e.jsx("button",{onClick:g,className:B.whiteButton,children:"Clear filters"})]})]})})}const ge="_Search_6hey7_1",be="_searchForm_6hey7_9",ve="_searchButton_6hey7_19",P={Search:ge,searchForm:be,searchButton:ve};function ye({setStateParameters:t,query:r,setQuery:c,setReRender:s,reRender:a}){function l(u){u.preventDefault();const h={};if(t({}),r.includes(":")){const d=r.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(d);for(let p=0;p<d.length-1;p+=2){const _=d[p],j=d[p+1];h[_]=j}t(h)}s(!a)}return e.jsxs("form",{className:P.searchForm,onSubmit:u=>l(u),children:[e.jsx("input",{value:r,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:u=>c(u.target.value),type:"text",className:P.Search}),e.jsx("button",{className:`${B.redButton} ${P.searchButton}`,children:"Go!"})]})}function Ce({MemberList:t=[]}){const[r,c]=i.useState(""),[s,a]=i.useState({}),[l,u]=i.useState(!1),[h,d]=i.useState(!1),p=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],_=()=>{d(g=>!g)},j=t.filter(g=>{const n=g.fields;let o={...s};const x=Object.keys(o).length;if(!x&&r!==""){for(const v in n){const y=n[v];if(y&&y.toString().toLowerCase().includes(r.toLowerCase()))return!0}return!1}else{if(!x&&r==="")return!0;if(x>0){if(p.some(({before:y,after:D})=>y in o||D in o)&&!b(n,o)||o.address1&&!m(n,o))return!1;for(const y of Object.keys(o)){const D=o[y];if(!(n[y]!==null?n[y].toString().toLowerCase():"").includes(D))return!1}return!0}}});function m(g,n){return!!(g.address1.includes(n.address1)||g.address2.includes(n.address1))}function b(g,n){let o=!0;for(const{base:x,before:v,after:y}of p){const D=n[v],f=n[y];D&&f?o=o&&F(g[x]).isBetween(n[y],n[v]):D?o=o&&F(g[x]).isBefore(n[v]):f&&(o=o&&F(g[x]).isAfter(n[y])),D&&delete n[v],f&&delete n[y]}return o}return e.jsxs("div",{className:N.fullPage,children:[e.jsxs("header",{className:N.searchBar,children:[e.jsx(ye,{setStateParameters:a,query:r,setQuery:c,setReRender:u,reRender:l}),e.jsxs("a",{className:N.toggleAdvancedSearch,onClick:_,children:[h?"Close":"Open"," advanced search"]})]}),e.jsxs("div",{className:N.content,children:[e.jsx(xe,{setStateParameters:a,isVisible:h}),e.jsx("main",{className:N.membersList,children:j.length>0?j.map(g=>e.jsx(ae,{memberId:g.pk,fields:g.fields},g.pk)):e.jsx("li",{children:"No results found"})},l)]})]})}const Se="_logoHeader_1iozh_1",De={logoHeader:Se},we="/static/react/headerlogo-400x400-vDrkEIdg.png";function G(){return e.jsxs("header",{className:De.logoHeader,children:[e.jsx("img",{src:we}),e.jsxs("h2",{children:["DSA ",e.jsx("br",{}),"Membership",e.jsx("br",{}),"Visualizer"]})]})}const Ne="_navBar_1cdgm_1",Fe="_pageOptions_1cdgm_27",U={navBar:Ne,pageOptions:Fe};function Me(){return e.jsxs("nav",{className:U.navBar,children:[e.jsx(G,{}),e.jsxs("div",{className:U.pageOptions,children:[e.jsx("a",{href:"/admin/",children:"Admin"}),e.jsx(C.Link,{to:"/app/search",children:"Search"}),e.jsx(C.Link,{to:"/app/statistics",children:"Statistics"}),e.jsx(C.Link,{to:"/app/weeklies",children:"Membership Changes"}),e.jsx(C.Link,{to:"/app/logout",children:"Log out"})]})]})}function Le(){const{members:t,isLoading:r}=i.useContext(z);return r?e.jsx("p",{children:"Loading members..."}):e.jsx("div",{className:"MembersList",children:e.jsx(Ce,{MemberList:t})})}function Ae(){return e.jsxs("div",{children:["Page not found. Have you forgotten to log in to the ",e.jsx("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function H({data:t,type:r}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function s(a){const l=a[0].slice(1);let u=a[1],h=a[a.length-1],d=[u,h];const _=[["Metric",...[u[0],h[0]],"% Change"]];return l.forEach((j,m)=>{const b=d.map(f=>f[m+1]),g=b[0],n=b[b.length-1],o=g!==0?(n-g)/Math.abs(g)*100:0,x=o>0?"⬆️":o<0?"⬇️":"—",v=o<0?"red":o>0?"green":"black",y=`${x} <span style="color:${v};">${o.toFixed(2)}%</span>`,D=[j,...b,y];_.push(D)}),_}return!t||!Array.isArray(t)||t.length===0||t[0].length===0?e.jsx("p",{children:"Loading chart data..."}):e.jsx(X,{chartType:r,data:r==="Table"?s(t):t,options:c,legendToggle:!0})}const ke="_chartContainer_1rjw7_1",Oe="_numbersAside_1rjw7_17",Be="_chartForm_1rjw7_29",Re="_chartAside_1rjw7_61",Te="_statistics_1rjw7_81",$e="_asideContainer_1rjw7_119",L={chartContainer:ke,numbersAside:Oe,chartForm:Be,chartAside:Re,statistics:Te,asideContainer:$e};function W({asideName:t,datesRange:r,defaultDates:c,setDates:s}){const[a,l]=i.useState({});function u(d,p){l(_=>({..._,[d]:p}))}function h(d){d.preventDefault(),s(Object.values(a))}return e.jsxs("form",{className:L.chartForm,children:[e.jsx(Y,{name:`${t}_from`,setQuery:u,defaultDate:c[0],datesRange:r}),e.jsx(Y,{name:`${t}_to`,setQuery:u,defaultDate:c[1],datesRange:r})," ",e.jsx("button",{className:B.redButton,onClick:d=>h(d),children:"Go!"})]})}function Ee(){const[t,r]=i.useState(null),[c,s]=i.useState(null),[a,l]=i.useState(null),[u,h]=i.useState(!0),[d,p]=i.useState([]),[_,j]=i.useState(!0),[m,b]=i.useState([]),[g,n]=i.useState([]),o=[];i.useEffect(()=>{async function f(){try{const w=await(await fetch("/api/membership_counts/")).json();r(w)}catch(S){console.error("Failed to fetch membershipCount",S)}finally{h(!1)}}f()},[]);function x(f){if(f.splice(2,1),f.splice(0,1),typeof f[1]=="string")for(let S=0;S<f.length;S++)f[S]=f[S].charAt(0).toUpperCase()+f[S].slice(1).replaceAll("_"," ");return f}function v(f){var S=f,w=S.sort(function(M,A){return Date.parse(M)>Date.parse(A)});b([w[0],w[w.length-1]])}i.useEffect(()=>{if(t){let f=Object.keys(t[0]),S=[];f=x(f),o.push(f);for(const w of t)S.push(w.list_date),f=Object.values(w),f=x(f),o.push(f);s(o),l(o),v(S)}},[t]),i.useEffect(()=>{m&&c&&y(m)},[m]),i.useEffect(()=>{D()},[]);function y(f){if(!f||Object.keys(f).length!==2||!c)return;const S=F(f[0]).format("YYYY-MM-DD"),w=F(f[1]).format("YYYY-MM-DD");let M=[c[0]];for(let A=1;A<c.length;A++){const I=F(c[A][0]).format("YYYY-MM-DD");(F(I).isBetween(S,w)||F(I).isSame(S)||F(I).isSame(w))&&M.push(c[A])}l(M),p(M)}async function D(){j(!0);try{const S=await(await fetch("/api/earliest_listdate/")).json(),w=S.earliest_date,M=S.latest_date;n([w,M])}catch(f){console.error("Failed to fetch earliest date",f)}finally{j(!1)}}return t?u||_?e.jsx("p",{children:"Loading statistics..."}):e.jsxs("main",{className:L.statistics,children:[e.jsx(W,{datesRange:g,defaultDates:m,asideName:"chart",setDates:b}),e.jsxs("div",{className:L.asideContainer,children:[e.jsxs("aside",{className:L.numbersAside,children:[e.jsx("h2",{children:"Percent Change Over Time"}),e.jsx("div",{className:L.chartContainer,children:e.jsx(H,{data:d,type:"Table"})})]}),e.jsxs("aside",{className:L.chartAside,children:[e.jsx("h2",{children:"Area Chart of Membership Trends"}),e.jsx("div",{className:L.chartContainer,children:e.jsx(H,{data:a,type:"AreaChart"})})]})]})]}):e.jsx("p",{children:"Membership statistics not found."})}const Ie="_error_1tgho_29",Pe="_loginPage_1tgho_45",Ve="_loginContainer_1tgho_61",V={error:Ie,loginPage:Pe,loginContainer:Ve};function K({onLoginSuccess:t,setAccessToken:r,setRefreshToken:c}){const[s,a]=i.useState(""),[l,u]=i.useState(""),[h,d]=i.useState(""),p=C.useNavigate(),_=q.get("csrftoken"),j=async m=>{m.preventDefault();try{const b=await $.post("/api/login/",{username:s,password:l},{headers:{"X-CSRFToken":_},withCredentials:!0});d(null),r(b.data.access),c(b.data.refresh),p("/app/search"),t(),console.log("navigating")}catch(b){console.error("Login failed:",b);const g=b?.data?.error||b?.data?.detail||b?.message||b?.data||"Login failed due to an unknown error.";d(g)}};return e.jsx("main",{className:V.loginPage,children:e.jsxs("form",{className:V.loginContainer,onSubmit:j,children:[e.jsxs("div",{className:V.error,style:{display:h?"block":"none"},children:["Error: ",h+"."]}),e.jsx(G,{}),e.jsx("label",{htmlFor:"username",children:"Username: "}),e.jsx("input",{htmlFor:"username",type:"username",onChange:m=>a(m.target.value)}),e.jsx("label",{htmlFor:"password",children:"Password: "}),e.jsx("input",{htmlFor:"password",type:"password",onChange:m=>u(m.target.value)}),e.jsx("button",{className:B.redButton,children:"Log in"})]})})}function Ye({onLogoutSuccess:t}){return t(),e.jsx(K,{})}function ze(){const{memberId:t}=C.useParams(),{members:r,isLoading:c}=i.useContext(z),[s,a]=i.useState(null),[l,u]=i.useState(!1);return i.useEffect(()=>{const h=r.find(d=>d.pk.toString()===t);if(h)a(h);else{async function d(){u(!0);try{const _=await(await fetch(`/api/${t}/data`)).json();a(JSON.parse(_))}catch(p){console.error("Failed to fetch member data",p)}finally{u(!1)}}d()}},[t,r]),c||l?e.jsx("p",{children:"Loading member details..."}):s?e.jsx("div",{className:E.cardContainer,children:e.jsxs("div",{className:E.memberCardFull,children:[e.jsxs("h1",{children:[s.fields.first_name," ",s.fields.last_name]}),e.jsxs("section",{for:"committees_and_unions",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Committee:"}),s.fields.committee.length===0?" N/A":s.fields.committee]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union member:"})," ",s.fields.union_member]}),s.fields.union_name===""?e.jsx("span",{}):e.jsxs("p",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Union name:"})," ",s.fields.union_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union local?:"})," ",s.fields.union_local]})]})]}),e.jsxs("section",{for:"contact",children:[e.jsx("h2",{children:"Contact information"}),e.jsxs("div",{children:[e.jsx("b",{children:"Best phone number:"})," ",s.fields.best_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile phone:"})," ",s.fields.mobile_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.fields.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord:"})," ",s.fields.discord_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord status:"})," ",s.fields.discord_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mailing address:"})," ",s.fields.address1,","," ",s.fields.city," ",s.fields.zip,", ",s.fields.country]})]}),e.jsxs("section",{for:"membership_info",children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",s.fields.membership_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"DSA Chapter:"})," ",s.fields.dsa_chapter]}),e.jsxs("div",{children:[e.jsx("b",{children:"Membership type:"})," ",s.fields.membership_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Joined in the past month?:"}),s.fields.new_member_past_month]}),e.jsxs("div",{children:[e.jsx("b",{children:"Monthly dues status:"})," ",s.fields.monthly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Yearly dues status:"})," ",s.fields.yearly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Join Date:"})," ",s.fields.join_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Expiry Date:"})," ",s.fields.xdate]})]})]})}):e.jsx("p",{children:"Member not found."})}const Ue=async(t,r,c,s)=>{try{const a=await $.get("/api/validate-token/",{headers:{Authorization:`Bearer ${t}`},withCredentials:!1});return!0}catch(a){if(a.response?.status===401&&s)try{const l=await $.post("api/validate-refresh-token/",{refresh:r},{withCredentials:!1});return c(l.data.access),!0}catch{return!1}}},O=({children:t,isValid:r,token:c})=>!c||!r?(c||console.log("no token found"),r||console.log("invalid token"),e.jsx(C.Navigate,{to:"/app/login",replace:!0})):t,He="_updated_k63vv_7",Je="_deleted_k63vv_15",J={new:"_new_k63vv_1",updated:He,deleted:Je};function Ge({data:t}){const{new_values:r,updated_values:c,deleted_values:s}=t,a=(h,d)=>Object.entries(h).map(([p,_])=>{const j=d==="updated"?_.current_values:_;return{id:p,first_name:j.first_name,last_name:j.last_name,email:j.email,change_field:d==="updated"?Object.keys(_.updated_values).join(", "):"",change_from:d==="updated"?Object.values(_.updated_values).map(([m,b])=>b).join(","):"",change_to:d==="updated"?Object.values(_.updated_values).map(([m])=>m).join(","):"",type:d}}),l=[...a(r,"new"),...a(c,"updated"),...a(s,"deleted")];console.log(l);const u=l.map(h=>{const d={};for(const[p,_]of Object.entries(h))d[p]=_===void 0?"":_;return d});return t?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Last Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Change Type"}),e.jsx("th",{children:"Change Field"}),e.jsx("th",{children:"Change From"}),e.jsx("th",{children:"Change To"})]})}),e.jsx("tbody",{children:u.map(({id:h,first_name:d,last_name:p,email:_,type:j,change_field:m,change_from:b,change_to:g})=>{const n=(m||"").split(", ").filter(Boolean),o=(b||"").split(",").filter(Boolean),x=(g||"").split(",").filter(Boolean);return e.jsxs(i.Fragment,{children:[e.jsxs("tr",{className:J[j],children:[e.jsx("td",{children:(j=="updated",d)}),e.jsx("td",{children:(j=="updated",p)}),e.jsx("td",{children:(j=="updated",_)}),e.jsx("td",{children:j}),e.jsx("td",{children:n[0]||""}),e.jsx("td",{children:o[0]||""}),e.jsx("td",{children:x[0]||""})]}),j==="updated"&&n.slice(1).map((v,y)=>e.jsxs("tr",{className:J[j],children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:v}),e.jsx("td",{children:o[y+1]||""}),e.jsx("td",{children:x[y+1]||""})]},`${h}-${v}`))]},h)})})]}):e.jsx("div",{children:"Data not found for that range."})}function We(){const[t,r]=i.useState([]),[c,s]=i.useState([]),[a,l]=i.useState([]),[u,h]=i.useState(!0),[d,p]=i.useState(!1),[_,j]=i.useState(!0);function m(){const n=new Date,o=new Date(n);o.setDate(n.getDate()-7);const x=D=>D.toISOString().split("T")[0],v=x(n),y=x(o);r([y,v]),console.log("in setDefaultDates:",[y,v])}i.useEffect(()=>{m(),g()},[]),i.useEffect(()=>{t.length===2&&(b(),console.log("Dates",t))},[t]);async function b(){console.log("in fetchMembershipData:"),p(!1),j(!0);const n=v=>v instanceof Date?v.toISOString().split("T")[0]:v,o=n(t[0]),x=n(t[1]);try{const v=await fetch(`/api/membership-updates/${o}/${x}`);if(!v.ok){const D=await v.text();throw p(!0),new Error(`Server error ${v.status}: ${D}`)}const y=await v.json();l(y)}catch(v){console.error("Failed to fetch membership updates",v)}finally{j(!1)}}async function g(){h(!0);try{const x=(await(await fetch("/api/earliest_listdate/")).json()).earliest_date;console.log("earliest ",x);const D=(f=>f.toISOString().split("T")[0])(new Date);console.log("todayStr",D),s([x,D])}catch(n){console.error("Failed to fetch earliest date",n)}finally{h(!1)}}return e.jsxs("div",{children:[e.jsx(W,{datesRange:c,asideName:"chart",defaultDates:t,setDates:r}),d?e.jsx("p",{children:"Data not found for that date range. Try inputting a different range."}):_||u?e.jsx("p",{children:"Loading data..."}):e.jsx(Ge,{data:a})]})}function Ke(){const[t,r]=i.useState(null),[c,s]=i.useState(null),[a,l]=i.useState(null),[u,h]=i.useState(!0);i.useEffect(()=>{(async()=>{let j=c;if(!j)try{j=(await $.post("api/validate-refresh-token/",{},{withCredentials:!0})).data.access,s(j)}catch(m){console.log("Token refresh failed:",m.response?.data||m.message)}if(j){const m=await Ue(j,a,l,s);r(m)}else r(!1);h(!1)})()},[]);const d=1e3*60*5,p=()=>{s(null),l(null),r(!1)};return u?e.jsx("div",{children:"Checking authentication..."}):e.jsxs(C.BrowserRouter,{children:[t&&e.jsx(Me,{}),e.jsxs(C.Routes,{children:[e.jsx(C.Route,{path:"/",element:e.jsx(C.Navigate,{to:"/app/search",replace:!0})}),e.jsx(C.Route,{path:"/app/search",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx(T,{children:e.jsx(Le,{})})})})}),e.jsx(C.Route,{path:"/app/statistics",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx(T,{children:e.jsx(Ee,{})})})})}),e.jsx(C.Route,{path:"/app/weeklies",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx(T,{children:e.jsx(We,{})})})})}),e.jsx(C.Route,{path:"/app/members/:memberId",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx(T,{children:e.jsx(ze,{})})})})}),e.jsx(C.Route,{path:"/app/logout",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(Ye,{onLogoutSuccess:()=>r(!1)})})}),e.jsx(C.Route,{path:"/app/login",element:e.jsx(K,{onLoginSuccess:()=>r(!0),setAccessToken:s,setRefreshToken:l})}),e.jsx(C.Route,{path:"*",element:t?e.jsx(Ae,{}):e.jsx(C.Navigate,{to:"/app/login",replace:!0})})]})]})}Z.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(Ke,{})}));
