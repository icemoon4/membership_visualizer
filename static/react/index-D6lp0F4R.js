import{r as l,j as e,m as C,D as G,a as A,C as K,b as W,c as O,_ as $,R as Q,d as X}from"./vendor-Fm9ckxW3.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function c(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(r){if(r.ep)return;r.ep=!0;const o=c(r);fetch(r.href,o)}})();const Y=l.createContext();function E({children:n}){const[s,c]=l.useState([]),[t,r]=l.useState(!0);return l.useEffect(()=>{async function o(){try{const h=await(await fetch("/api/data")).json();c(JSON.parse(h))}catch(u){console.error("Failed to fetch members",u)}finally{r(!1)}}o()},[]),e.jsx(Y.Provider,{value:{members:s,isLoading:t},children:n})}const q="_memberCard_1uz18_1",Z="_memberTitle_1uz18_13",ee="_cardContainer_1uz18_23",te="_memberCardFull_1uz18_63",T={memberCard:q,memberTitle:Z,cardContainer:ee,memberCardFull:te};function se({memberId:n,fields:s}){return e.jsxs("div",{className:T.memberCard,children:[e.jsxs(C.Link,{to:`/app/members/${n}`,state:{memberFields:s},className:T.memberTitle,children:[e.jsxs("span",{children:[s.first_name," "]})," ",e.jsx("span",{children:s.last_name})," ",e.jsxs("span",{children:[" - ",s.membership_status]})]}),e.jsxs("div",{children:["Join date: ",s.join_date]}),e.jsxs("div",{children:["Expiry date: ",s.xdate]}),e.jsxs("div",{children:["Email: ",s.email]}),e.jsxs("div",{children:["Address: ",s.address1," ",s.address2,", ",s.city," ",s.state," ",s.vaccinated]})]})}const ne="_fullPage_7eejv_1",re="_searchBar_7eejv_13",ae="_inactive_7eejv_33",ie="_active_7eejv_41",oe="_buttonsContainer_7eejv_49",ce="_toggleAdvancedSearch_7eejv_59",le="_filterSideBar_7eejv_71",de="_content_7eejv_89",ue="_membersList_7eejv_113",N={fullPage:ne,searchBar:re,inactive:ae,active:ie,buttonsContainer:oe,toggleAdvancedSearch:ce,filterSideBar:le,content:de,membersList:ue};function he({name:n,setQuery:s}){function c(t){return t==="address1"?"Address: ":t.charAt(0).toUpperCase()+t.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${c(n)}`}),e.jsx("input",{id:`adv_${n}`,type:"text",onChange:t=>s(n,t.target.value)})]})}function L({name:n,selectOptions:s=[],setQuery:c}){function t(r){return r==="student_yes_no"?"Student?: ":r.charAt(0).toUpperCase()+r.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${t(n)}`}),e.jsx("select",{id:`adv_${n}`,name:`adv_${n}`,onChange:r=>c(n,r.target.value),children:s.map(r=>e.jsx("option",{value:r,children:r},`adv_${r}`))})]})}function V({name:n,setQuery:s,resetDates:c,defaultDate:t,datesRange:r}){const[o,u]=l.useState(t||new Date),[h,f]=l.useState([]),[_,v]=l.useState(!1);function g(i){return i==="xdate_before"?"Membership expires before: ":i=="xdate_after"?"Membership expires after: ":i==="join_date_after"?"Joined after: ":i==="join_date_before"?"Joined before: ":i.charAt(0).toUpperCase()+i.slice(1).replaceAll("_"," ")+": "}function p(i,b){u(b),s(i,b),v(!0)}l.useEffect(()=>{u(new Date),v(!1)},[c]),l.useEffect(()=>{h.length===0&&r!==void 0&&f(x(r))},[r]);function x(i){return i.map(b=>typeof b=="string"?m(b):b)}function m(i){return new Date(i.replace("-","/"))}l.useEffect(()=>{if(t){let i=t;typeof t=="string"&&(i=m(i),p(n,i)),u(i)}},[t]);function a(){v(!0)}return e.jsxs("div",{children:[e.jsx("label",{children:`${g(n)}`}),e.jsx(G,{className:_?N.active:N.inactive,selected:o,onChange:i=>p(n,i),onCalendarOpen:a,includeDateIntervals:r?[{start:h[0],end:h[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const me="_redButton_ta6ja_101",fe="_whiteButton_ta6ja_119",k={redButton:me,whiteButton:fe};function pe({setStateParameters:n,isVisible:s}){const[c,t]=l.useState({}),[r,o]=l.useState(!1),u=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],h=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],f=["join_date_before","join_date_after","xdate_before","xdate_after"],_=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],v=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],g=["","Member","Member in Good Standing","Lapsed"];function p(a,i){i=i.toString().toLowerCase(),a==="union_member"&&(i=i==="true"?"yes":"no"),t(b=>({...b,[a]:i}))}function x(a){a.preventDefault(),n(c)}function m(){document.querySelector("#advancedFilterForm").reset(),t({}),n({}),o(a=>!a)}return e.jsx("aside",{className:N.filterSideBar,children:s&&e.jsxs("form",{id:"advancedFilterForm",style:{display:s?"block":"none"},onSubmit:a=>x(a),children:[u.map(a=>h.includes(a)?e.jsx(he,{name:a,setQuery:p},`component_${a}`):_.includes(a)?e.jsx(L,{name:a,selectOptions:["","True","False"],setQuery:p},`component_${a}`):f.includes(a)?e.jsx(V,{name:a,setQuery:p,resetDates:r,setResetDates:o},`component_${a}_${r}`):a==="membership_status"?e.jsx(L,{name:a,selectOptions:g,setQuery:p},`component_${a}`):a==="student_yes_no"?e.jsx(L,{name:a,selectOptions:["","Yes","No"],setQuery:p},`component_${a}`):a==="mailing_pref"?e.jsx(L,{name:a,selectOptions:["","Yes","No"],setQuery:p},`component_${a}`):a==="state"?e.jsx(L,{name:a,selectOptions:v,setQuery:p},`component_${a}`):console.log("unrecognized field; how'd you manage this?")),e.jsxs("div",{className:N.buttonsContainer,children:[e.jsx("button",{onClick:x,className:k.redButton,children:"Search"}),e.jsx("button",{onClick:m,className:k.whiteButton,children:"Clear filters"})]})]})})}const _e="_Search_6hey7_1",je="_searchForm_6hey7_9",xe="_searchButton_6hey7_19",I={Search:_e,searchForm:je,searchButton:xe};function be({setStateParameters:n,query:s,setQuery:c,setReRender:t,reRender:r}){function o(u){u.preventDefault();const h={};if(n({}),s.includes(":")){const f=s.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(f);for(let _=0;_<f.length-1;_+=2){const v=f[_],g=f[_+1];h[v]=g}n(h)}t(!r)}return e.jsxs("form",{className:I.searchForm,onSubmit:u=>o(u),children:[e.jsx("input",{value:s,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:u=>c(u.target.value),type:"text",className:I.Search}),e.jsx("button",{className:`${k.redButton} ${I.searchButton}`,children:"Go!"})]})}function ge({MemberList:n=[]}){const[s,c]=l.useState(""),[t,r]=l.useState({}),[o,u]=l.useState(!1),[h,f]=l.useState(!1),_=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],v=()=>{f(m=>!m)},g=n.filter(m=>{const a=m.fields;let i={...t};const b=Object.keys(i).length;if(!b&&s!==""){for(const S in a){const y=a[S];if(y&&y.toString().toLowerCase().includes(s.toLowerCase()))return!0}return!1}else{if(!b&&s==="")return!0;if(b>0){if(_.some(({before:y,after:d})=>y in i||d in i)&&!x(a,i)||i.address1&&!p(a,i))return!1;for(const y of Object.keys(i)){const d=i[y];if(!(a[y]!==null?a[y].toString().toLowerCase():"").includes(d))return!1}return!0}}});function p(m,a){return!!(m.address1.includes(a.address1)||m.address2.includes(a.address1))}function x(m,a){let i=!0;for(const{base:b,before:S,after:y}of _){const d=a[S],j=a[y];d&&j?i=i&&A(m[b]).isBetween(a[y],a[S]):d?i=i&&A(m[b]).isBefore(a[S]):j&&(i=i&&A(m[b]).isAfter(a[y])),d&&delete a[S],j&&delete a[y]}return i}return e.jsxs("div",{className:N.fullPage,children:[e.jsxs("header",{className:N.searchBar,children:[e.jsx(be,{setStateParameters:r,query:s,setQuery:c,setReRender:u,reRender:o}),e.jsxs("a",{className:N.toggleAdvancedSearch,onClick:v,children:[h?"Close":"Open"," advanced search"]})]}),e.jsxs("div",{className:N.content,children:[e.jsx(pe,{setStateParameters:r,isVisible:h}),e.jsx("main",{className:N.membersList,children:g.length>0?g.map(m=>e.jsx(se,{memberId:m.pk,fields:m.fields},m.pk)):e.jsx("li",{children:"No results found"})},o)]})]})}const ve="_logoHeader_1iozh_1",Ce={logoHeader:ve},ye="/static/react/headerlogo-400x400-vDrkEIdg.png";function H(){return e.jsxs("header",{className:Ce.logoHeader,children:[e.jsx("img",{src:ye}),e.jsxs("h2",{children:["DSA ",e.jsx("br",{}),"Membership",e.jsx("br",{}),"Visualizer"]})]})}const Se="_navBar_1cdgm_1",De="_pageOptions_1cdgm_27",z={navBar:Se,pageOptions:De};function Ne(){return e.jsxs("nav",{className:z.navBar,children:[e.jsx(H,{}),e.jsxs("div",{className:z.pageOptions,children:[e.jsx("a",{href:"/admin/",children:"Admin"}),e.jsx(C.Link,{to:"/app/search",children:"Search"}),e.jsx(C.Link,{to:"/app/statistics",children:"Statistics"}),e.jsx(C.Link,{to:"/app/logout",children:"Log out"})]})]})}function Ae(){const{members:n,isLoading:s}=l.useContext(Y);return s?e.jsx("p",{children:"Loading members..."}):e.jsx("div",{className:"MembersList",children:e.jsx(ge,{MemberList:n})})}function we(){return e.jsxs("div",{children:["Page not found. Have you forgotten to log in to the ",e.jsx("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function U({data:n,type:s}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function t(r){const o=r[0].slice(1);let u=r[1],h=r[r.length-1],f=[u,h];const v=[["Metric",...[u[0],h[0]],"% Change"]];return o.forEach((g,p)=>{const x=f.map(j=>j[p+1]),m=x[0],a=x[x.length-1],i=m!==0?(a-m)/Math.abs(m)*100:0,b=i>0?"⬆️":i<0?"⬇️":"—",S=i<0?"red":i>0?"green":"black",y=`${b} <span style="color:${S};">${i.toFixed(2)}%</span>`,d=[g,...x,y];v.push(d)}),v}return!n||!Array.isArray(n)||n.length===0||n[0].length===0?e.jsx("p",{children:"Loading chart data..."}):e.jsx(K,{chartType:s,data:s==="Table"?t(n):n,options:c,legendToggle:!0})}const Fe="_chartContainer_1rjw7_1",Me="_numbersAside_1rjw7_17",Le="_chartForm_1rjw7_29",ke="_chartAside_1rjw7_61",Be="_statistics_1rjw7_81",Oe="_asideContainer_1rjw7_119",w={chartContainer:Fe,numbersAside:Me,chartForm:Le,chartAside:ke,statistics:Be,asideContainer:Oe};function Te({asideName:n,dates:s,setDates:c}){const[t,r]=l.useState({});function o(h,f){r(_=>({..._,[h]:f}))}function u(h){h.preventDefault(),c(Object.values(t))}return e.jsxs("form",{className:w.chartForm,children:[e.jsx(V,{name:`${n}_from`,setQuery:o,defaultDate:s[0],datesRange:s}),e.jsx(V,{name:`${n}_to`,setQuery:o,defaultDate:s[1],datesRange:s})," ",e.jsx("button",{className:k.redButton,onClick:h=>u(h),children:"Go!"})]})}function Re(){const[n,s]=l.useState(null),[c,t]=l.useState(null),[r,o]=l.useState(null),[u,h]=l.useState(!0),[f,_]=l.useState([]),[v,g]=l.useState([]),[p,x]=l.useState([]),[m,a]=l.useState([]);console.log("call 0"+m);const i=[];l.useEffect(()=>{async function d(){try{const D=await(await fetch("/api/membership_counts/")).json();s(D)}catch(j){console.error("Failed to fetch membershipCount",j)}finally{h(!1)}}d()},[]);function b(d){if(d.splice(2,1),d.splice(0,1),typeof d[1]=="string")for(let j=0;j<d.length;j++)d[j]=d[j].charAt(0).toUpperCase()+d[j].slice(1).replaceAll("_"," ");return d}function S(d){var j=d,D=j.sort(function(M,F){return Date.parse(M)>Date.parse(F)});console.log("call 1"+j),a([D[0],D[D.length-1]]),console.log("call 2"+j)}l.useEffect(()=>{if(n){let d=Object.keys(n[0]),j=[];d=b(d),i.push(d);for(const D of n)j.push(D.list_date),d=Object.values(D),d=b(d),i.push(d);t(i),o(i),S(j)}},[n]),l.useEffect(()=>{m&&c&&y(m)},[m]);function y(d){if(!d||Object.keys(d).length!==2||!c)return;const j=A(d[0]).format("YYYY-MM-DD"),D=A(d[1]).format("YYYY-MM-DD");let M=[c[0]];for(let F=1;F<c.length;F++){const R=A(c[F][0]).format("YYYY-MM-DD");(A(R).isBetween(j,D)||A(R).isSame(j)||A(R).isSame(D))&&M.push(c[F])}o(M),_(M)}return n?u?e.jsx("p",{children:"Loading statistics..."}):e.jsxs("main",{className:w.statistics,children:[e.jsx(Te,{dates:m,asideName:"chart",setDates:a}),e.jsxs("div",{className:w.asideContainer,children:[e.jsxs("aside",{className:w.numbersAside,children:[e.jsx("h2",{children:"Percent Change Over Time"}),e.jsx("div",{className:w.chartContainer,children:e.jsx(U,{data:f,type:"Table"})})]}),e.jsxs("aside",{className:w.chartAside,children:[e.jsx("h2",{children:"Area Chart of Membership Trends"}),e.jsx("div",{className:w.chartContainer,children:e.jsx(U,{data:r,type:"AreaChart"})})]})]})]}):e.jsx("p",{children:"Membership statistics not found."})}const $e="_error_1tgho_29",Ee="_loginPage_1tgho_45",Ie="_loginContainer_1tgho_61",P={error:$e,loginPage:Ee,loginContainer:Ie};function J({onLoginSuccess:n,setAccessToken:s,setRefreshToken:c}){const[t,r]=l.useState(""),[o,u]=l.useState(""),[h,f]=l.useState(""),_=C.useNavigate(),v=W.get("csrftoken"),g=async p=>{p.preventDefault();try{const x=await O.post("/api/login/",{username:t,password:o},{headers:{"X-CSRFToken":v},withCredentials:!0});f(null),s(x.data.access),c(x.data.refresh),_("/app/search"),n(),console.log("navigating")}catch(x){console.error("Login failed:",x);const m=x?.data?.error||x?.data?.detail||x?.message||x?.data||"Login failed due to an unknown error.";f(m)}};return e.jsx("main",{className:P.loginPage,children:e.jsxs("form",{className:P.loginContainer,onSubmit:g,children:[e.jsxs("div",{className:P.error,style:{display:h?"block":"none"},children:["Error: ",h+"."]}),e.jsx(H,{}),e.jsx("label",{htmlFor:"username",children:"Username: "}),e.jsx("input",{htmlFor:"username",type:"username",onChange:p=>r(p.target.value)}),e.jsx("label",{htmlFor:"password",children:"Password: "}),e.jsx("input",{htmlFor:"password",type:"password",onChange:p=>u(p.target.value)}),e.jsx("button",{className:k.redButton,children:"Log in"})]})})}function Pe({onLogoutSuccess:n}){return n(),e.jsx(J,{})}function Ve(){const{memberId:n}=C.useParams(),{members:s,isLoading:c}=l.useContext(Y),[t,r]=l.useState(null),[o,u]=l.useState(!1);return l.useEffect(()=>{const h=s.find(f=>f.pk.toString()===n);if(h)r(h);else{async function f(){u(!0);try{const v=await(await fetch(`/api/${n}/data`)).json();r(JSON.parse(v))}catch(_){console.error("Failed to fetch member data",_)}finally{u(!1)}}f()}},[n,s]),c||o?e.jsx("p",{children:"Loading member details..."}):t?e.jsx("div",{className:T.cardContainer,children:e.jsxs("div",{className:T.memberCardFull,children:[e.jsxs("h1",{children:[t.fields.first_name," ",t.fields.last_name]}),e.jsxs("section",{for:"committees_and_unions",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Committee:"}),t.fields.committee.length===0?" N/A":t.fields.committee]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union member:"})," ",t.fields.union_member]}),t.fields.union_name===""?e.jsx("span",{}):e.jsxs("p",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Union name:"})," ",t.fields.union_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union local?:"})," ",t.fields.union_local]})]})]}),e.jsxs("section",{for:"contact",children:[e.jsx("h2",{children:"Contact information"}),e.jsxs("div",{children:[e.jsx("b",{children:"Best phone number:"})," ",t.fields.best_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile phone:"})," ",t.fields.mobile_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",t.fields.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord:"})," ",t.fields.discord_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord status:"})," ",t.fields.discord_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mailing address:"})," ",t.fields.address1,","," ",t.fields.city," ",t.fields.zip,", ",t.fields.country]})]}),e.jsxs("section",{for:"membership_info",children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",t.fields.membership_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"DSA Chapter:"})," ",t.fields.dsa_chapter]}),e.jsxs("div",{children:[e.jsx("b",{children:"Membership type:"})," ",t.fields.membership_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Joined in the past month?:"}),t.fields.new_member_past_month]}),e.jsxs("div",{children:[e.jsx("b",{children:"Monthly dues status:"})," ",t.fields.monthly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Yearly dues status:"})," ",t.fields.yearly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Join Date:"})," ",t.fields.join_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Expiry Date:"})," ",t.fields.xdate]})]})]})}):e.jsx("p",{children:"Member not found."})}const Ye=async(n,s,c,t)=>{try{const r=await O.get("/api/validate-token/",{headers:{Authorization:`Bearer ${n}`},withCredentials:!1});return!0}catch(r){if(r.response?.status===401&&t)try{const o=await O.post("api/validate-refresh-token/",{refresh:s},{withCredentials:!1});return c(o.data.access),!0}catch{return!1}}},B=({children:n,isValid:s,token:c})=>!c||!s?(c||console.log("no token found"),s||console.log("invalid token"),e.jsx(C.Navigate,{to:"/app/login",replace:!0})):n;function ze(){const[n,s]=l.useState(null),[c,t]=l.useState(null),[r,o]=l.useState(null),[u,h]=l.useState(!0);l.useEffect(()=>{(async()=>{let g=c;if(!g)try{g=(await O.post("api/validate-refresh-token/",{},{withCredentials:!0})).data.access,t(g)}catch(p){console.log("Token refresh failed:",p.response?.data||p.message)}if(g){const p=await Ye(g,r,o,t);s(p)}else s(!1);h(!1)})()},[]);const f=1e3*60*5,_=()=>{t(null),o(null),s(!1)};return u?e.jsx("div",{children:"Checking authentication..."}):e.jsxs(C.BrowserRouter,{children:[n&&e.jsx(Ne,{}),e.jsxs(C.Routes,{children:[e.jsx(C.Route,{path:"/",element:e.jsx(C.Navigate,{to:"/app/search",replace:!0})}),e.jsx(C.Route,{path:"/app/search",element:e.jsx(B,{isValid:n,token:c,children:e.jsx($,{timeout:f,onIdle:_,children:e.jsx(E,{children:e.jsx(Ae,{})})})})}),e.jsx(C.Route,{path:"/app/statistics",element:e.jsx(B,{isValid:n,token:c,children:e.jsx($,{timeout:f,onIdle:_,children:e.jsx(E,{children:e.jsx(Re,{})})})})}),e.jsx(C.Route,{path:"/app/members/:memberId",element:e.jsx(B,{isValid:n,token:c,children:e.jsx($,{timeout:f,onIdle:_,children:e.jsx(E,{children:e.jsx(Ve,{})})})})}),e.jsx(C.Route,{path:"/app/logout",element:e.jsx(B,{isValid:n,token:c,children:e.jsx(Pe,{onLogoutSuccess:()=>s(!1)})})}),e.jsx(C.Route,{path:"/app/login",element:e.jsx(J,{onLoginSuccess:()=>s(!0),setAccessToken:t,setRefreshToken:o})}),e.jsx(C.Route,{path:"*",element:n?e.jsx(we,{}):e.jsx(C.Navigate,{to:"/app/login",replace:!0})})]})]})}Q.createRoot(document.getElementById("root")).render(e.jsx(X.StrictMode,{children:e.jsx(ze,{})}));
