import{r as o,j as e,m as C,D as Q,a as M,C as X,b as q,c as E,_ as R,R as Z,d as ee}from"./vendor-CLmwztiI.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function c(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=c(r);fetch(r.href,l)}})();const U=o.createContext();function $({children:t}){const[n,c]=o.useState([]),[s,r]=o.useState(!0);return o.useEffect(()=>{async function l(){try{const u=await(await fetch("/api/data")).json();c(JSON.parse(u))}catch(h){console.error("Failed to fetch members",h)}finally{r(!1)}}l()},[]),e.jsx(U.Provider,{value:{members:n,isLoading:s},children:t})}const te="_memberCard_186gy_1",se="_memberTitle_186gy_13",ne="_cardContainer_186gy_23",ae="_memberCardFull_186gy_63",I={memberCard:te,memberTitle:se,cardContainer:ne,memberCardFull:ae};function re({memberId:t,fields:n}){return e.jsxs("div",{className:I.memberCard,children:[e.jsxs(C.Link,{to:`/app/members/${t}`,state:{memberFields:n},className:I.memberTitle,children:[e.jsxs("span",{children:[n.first_name," "]})," ",e.jsx("span",{children:n.last_name})," ",e.jsxs("span",{children:[" - ",n.membership_status]})]}),e.jsxs("div",{children:["Join date: ",n.join_date]}),e.jsxs("div",{children:["Expiry date: ",n.xdate]}),e.jsxs("div",{children:["Email: ",n.email]}),e.jsxs("div",{children:["Address: ",n.address1," ",n.address2,", ",n.city," ",n.state," ",n.vaccinated]})]})}const ie="_fullPage_7eejv_1",oe="_searchBar_7eejv_13",ce="_inactive_7eejv_33",le="_active_7eejv_41",de="_buttonsContainer_7eejv_49",he="_toggleAdvancedSearch_7eejv_59",ue="_filterSideBar_7eejv_71",me="_content_7eejv_89",fe="_membersList_7eejv_113",N={fullPage:ie,searchBar:oe,inactive:ce,active:le,buttonsContainer:de,toggleAdvancedSearch:he,filterSideBar:ue,content:me,membersList:fe};function pe({name:t,setQuery:n}){function c(s){return s==="address1"?"Address: ":s.charAt(0).toUpperCase()+s.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${c(t)}`}),e.jsx("input",{id:`adv_${t}`,type:"text",onChange:s=>n(t,s.target.value)})]})}function T({name:t,selectOptions:n=[],setQuery:c}){function s(r){return r==="student_yes_no"?"Student?: ":r.charAt(0).toUpperCase()+r.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${s(t)}`}),e.jsx("select",{id:`adv_${t}`,name:`adv_${t}`,onChange:r=>c(t,r.target.value),children:n.map(r=>e.jsx("option",{value:r,children:r},`adv_${r}`))})]})}function H({name:t,setQuery:n,resetDates:c,defaultDate:s,datesRange:r}){const[l,h]=o.useState(s||new Date),[u,d]=o.useState([]),[p,_]=o.useState(!1);function j(i){return i==="xdate_before"?"Membership expires before: ":i=="xdate_after"?"Membership expires after: ":i==="join_date_after"?"Joined after: ":i==="join_date_before"?"Joined before: ":i.charAt(0).toUpperCase()+i.slice(1).replaceAll("_"," ")+": "}function m(i,x){h(x),n(i,x),_(!0)}o.useEffect(()=>{h(new Date),_(!1)},[c]),o.useEffect(()=>{u.length===0&&r!==void 0&&d(b(r))},[r]);function b(i){return i.map(x=>typeof x=="string"?g(x):x)}function g(i){return new Date(i.replace("-","/"))}o.useEffect(()=>{if(s){let i=s;typeof s=="string"&&(i=g(i),m(t,i)),h(i)}},[s]);function a(){_(!0)}return e.jsxs("div",{children:[e.jsx("label",{children:`${j(t)}`}),e.jsx(Q,{className:p?N.active:N.inactive,selected:l,onChange:i=>m(t,i),onCalendarOpen:a,includeDateIntervals:r?[{start:u[0],end:u[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const je="_redButton_ta6ja_101",_e="_whiteButton_ta6ja_119",B={redButton:je,whiteButton:_e};function xe({setStateParameters:t,isVisible:n}){const[c,s]=o.useState({}),[r,l]=o.useState(!1),h=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],u=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],d=["join_date_before","join_date_after","xdate_before","xdate_after"],p=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],_=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],j=["","Member","Member in Good Standing","Lapsed"];function m(a,i){i=i.toString().toLowerCase(),a==="union_member"&&(i=i==="true"?"yes":"no"),s(x=>({...x,[a]:i}))}function b(a){a.preventDefault(),t(c)}function g(){document.querySelector("#advancedFilterForm").reset(),s({}),t({}),l(a=>!a)}return e.jsx("aside",{className:N.filterSideBar,children:n&&e.jsxs("form",{id:"advancedFilterForm",style:{display:n?"block":"none"},onSubmit:a=>b(a),children:[h.map(a=>u.includes(a)?e.jsx(pe,{name:a,setQuery:m},`component_${a}`):p.includes(a)?e.jsx(T,{name:a,selectOptions:["","True","False"],setQuery:m},`component_${a}`):d.includes(a)?e.jsx(H,{name:a,setQuery:m,resetDates:r,setResetDates:l},`component_${a}_${r}`):a==="membership_status"?e.jsx(T,{name:a,selectOptions:j,setQuery:m},`component_${a}`):a==="student_yes_no"?e.jsx(T,{name:a,selectOptions:["","Yes","No"],setQuery:m},`component_${a}`):a==="mailing_pref"?e.jsx(T,{name:a,selectOptions:["","Yes","No"],setQuery:m},`component_${a}`):a==="state"?e.jsx(T,{name:a,selectOptions:_,setQuery:m},`component_${a}`):console.log("unrecognized field; how'd you manage this?")),e.jsxs("div",{className:N.buttonsContainer,children:[e.jsx("button",{onClick:b,className:B.redButton,children:"Search"}),e.jsx("button",{onClick:g,className:B.whiteButton,children:"Clear filters"})]})]})})}const ge="_Search_6hey7_1",be="_searchForm_6hey7_9",ve="_searchButton_6hey7_19",V={Search:ge,searchForm:be,searchButton:ve};function ye({setStateParameters:t,query:n,setQuery:c,setReRender:s,reRender:r}){function l(h){h.preventDefault();const u={};if(t({}),n.includes(":")){const d=n.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(d);for(let p=0;p<d.length-1;p+=2){const _=d[p],j=d[p+1];u[_]=j}t(u)}s(!r)}return e.jsxs("form",{className:V.searchForm,onSubmit:h=>l(h),children:[e.jsx("input",{value:n,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:h=>c(h.target.value),type:"text",className:V.Search}),e.jsx("button",{className:`${B.redButton} ${V.searchButton}`,children:"Go!"})]})}function Ce({MemberList:t=[]}){const[n,c]=o.useState(""),[s,r]=o.useState({}),[l,h]=o.useState(!1),[u,d]=o.useState(!1),p=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],_=()=>{d(g=>!g)},j=t.filter(g=>{const a=g.fields;let i={...s};const x=Object.keys(i).length;if(!x&&n!==""){for(const v in a){const y=a[v];if(y&&y.toString().toLowerCase().includes(n.toLowerCase()))return!0}return!1}else{if(!x&&n==="")return!0;if(x>0){if(p.some(({before:y,after:D})=>y in i||D in i)&&!b(a,i)||i.address1&&!m(a,i))return!1;for(const y of Object.keys(i)){const D=i[y];if(!(a[y]!==null?a[y].toString().toLowerCase():"").includes(D))return!1}return!0}}});function m(g,a){return!!(g.address1.includes(a.address1)||g.address2.includes(a.address1))}function b(g,a){let i=!0;for(const{base:x,before:v,after:y}of p){const D=a[v],f=a[y];D&&f?i=i&&M(g[x]).isBetween(a[y],a[v]):D?i=i&&M(g[x]).isBefore(a[v]):f&&(i=i&&M(g[x]).isAfter(a[y])),D&&delete a[v],f&&delete a[y]}return i}return e.jsxs("div",{className:N.fullPage,children:[e.jsxs("header",{className:N.searchBar,children:[e.jsx(ye,{setStateParameters:r,query:n,setQuery:c,setReRender:h,reRender:l}),e.jsxs("a",{className:N.toggleAdvancedSearch,onClick:_,children:[u?"Close":"Open"," advanced search"]})]}),e.jsxs("div",{className:N.content,children:[e.jsx(xe,{setStateParameters:r,isVisible:u}),e.jsx("main",{className:N.membersList,children:j.length>0?j.map(g=>e.jsx(re,{memberId:g.pk,fields:g.fields},g.pk)):e.jsx("li",{children:"No results found"})},l)]})]})}const Se="_logoHeader_1iozh_1",De={logoHeader:Se},we="/static/react/headerlogo-400x400-vDrkEIdg.png";function J(){return e.jsxs("header",{className:De.logoHeader,children:[e.jsx("img",{src:we}),e.jsxs("h2",{children:["DSA ",e.jsx("br",{}),"Membership",e.jsx("br",{}),"Visualizer"]})]})}const Ne="_navBar_1cdgm_1",Me="_pageOptions_1cdgm_27",W={navBar:Ne,pageOptions:Me};function Fe(){return e.jsxs("nav",{className:W.navBar,children:[e.jsx(J,{}),e.jsxs("div",{className:W.pageOptions,children:[e.jsx("a",{href:"/admin/",children:"Admin"}),e.jsx(C.Link,{to:"/app/search",children:"Search"}),e.jsx(C.Link,{to:"/app/statistics",children:"Statistics"}),e.jsx(C.Link,{to:"/app/weeklies",children:"Membership Changes"}),e.jsx(C.Link,{to:"/app/logout",children:"Log out"})]})]})}function Ae(){const{members:t,isLoading:n}=o.useContext(U);return n?e.jsx("p",{children:"Loading members..."}):e.jsx("div",{className:"MembersList",children:e.jsx(Ce,{MemberList:t})})}function Le(){return e.jsxs("div",{children:["Page not found. Have you forgotten to log in to the ",e.jsx("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function z({data:t,type:n}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function s(r){const l=r[0].slice(1);let h=r[1],u=r[r.length-1],d=[h,u];const _=[["Metric",...[h[0],u[0]],"% Change"]];return l.forEach((j,m)=>{const b=d.map(f=>f[m+1]),g=b[0],a=b[b.length-1],i=g!==0?(a-g)/Math.abs(g)*100:0,x=i>0?"⬆️":i<0?"⬇️":"—",v=i<0?"red":i>0?"green":"black",y=`${x} <span style="color:${v};">${i.toFixed(2)}%</span>`,D=[j,...b,y];_.push(D)}),_}return!t||!Array.isArray(t)||t.length===0||t[0].length===0?e.jsx("p",{children:"Loading chart data..."}):e.jsx(X,{chartType:n,data:n==="Table"?s(t):t,options:c,legendToggle:!0})}const ke="_chartContainer_1rjw7_1",Te="_numbersAside_1rjw7_17",Oe="_chartForm_1rjw7_29",Be="_chartAside_1rjw7_61",Re="_statistics_1rjw7_81",$e="_asideContainer_1rjw7_119",A={chartContainer:ke,numbersAside:Te,chartForm:Oe,chartAside:Be,statistics:Re,asideContainer:$e};function Ee({asideName:t,datesRange:n,defaultDates:c,setDates:s}){const[r,l]=o.useState({});function h(d,p){l(_=>({..._,[d]:p}))}function u(d){d.preventDefault(),s(Object.values(r))}return e.jsxs("form",{className:A.chartForm,children:[e.jsx(H,{name:"From",setQuery:h,defaultDate:c[0],datesRange:n}),e.jsx(H,{name:"to",setQuery:h,defaultDate:c[1],datesRange:n})," ",e.jsx("button",{className:B.redButton,onClick:d=>u(d),children:"Go!"})]})}const Ie="_updated_l8s61_17",Pe="_deleted_l8s61_33",Ve="_memberWeeklies_l8s61_55",Ye="_dataDisplayMain_l8s61_71",He="_statistics_l8s61_109",Ue="_tableTitle_l8s61_117",L={new:"_new_l8s61_1",updated:Ie,deleted:Pe,memberWeeklies:Ve,dataDisplayMain:Ye,statistics:He,tableTitle:Ue};function G({dateRange:t,dates:n,setDates:c,sectionTitle:s}){return e.jsxs("header",{children:[e.jsx("h2",{className:L.tableTitle,children:s}),e.jsx(Ee,{datesRange:t,asideName:"chart",defaultDates:n,setDates:c})]})}function We(){const[t,n]=o.useState(null),[c,s]=o.useState(null),[r,l]=o.useState(null),[h,u]=o.useState(!0),[d,p]=o.useState([]),[_,j]=o.useState(!0),[m,b]=o.useState([]),[g,a]=o.useState([]),i=[];o.useEffect(()=>{async function f(){try{const w=await(await fetch("/api/membership_counts/")).json();n(w)}catch(S){console.error("Failed to fetch membershipCount",S)}finally{u(!1)}}f()},[]);function x(f){if(f.splice(2,1),f.splice(0,1),typeof f[1]=="string")for(let S=0;S<f.length;S++)f[S]=f[S].charAt(0).toUpperCase()+f[S].slice(1).replaceAll("_"," ");return f}function v(f){var S=f,w=S.sort(function(F,k){return Date.parse(F)>Date.parse(k)});b([w[0],w[w.length-1]])}o.useEffect(()=>{if(t){let f=Object.keys(t[0]),S=[];f=x(f),i.push(f);for(const w of t)S.push(w.list_date),f=Object.values(w),f=x(f),i.push(f);s(i),l(i),v(S)}},[t]),o.useEffect(()=>{m&&c&&y(m)},[m]),o.useEffect(()=>{D()},[]);function y(f){if(!f||Object.keys(f).length!==2||!c)return;const S=M(f[0]).format("YYYY-MM-DD"),w=M(f[1]).format("YYYY-MM-DD");let F=[c[0]];for(let k=1;k<c.length;k++){const P=M(c[k][0]).format("YYYY-MM-DD");(M(P).isBetween(S,w)||M(P).isSame(S)||M(P).isSame(w))&&F.push(c[k])}l(F),p(F)}async function D(){j(!0);try{const S=await(await fetch("/api/earliest_listdate/")).json(),w=S.earliest_date,F=S.latest_date;a([w,F])}catch(f){console.error("Failed to fetch earliest date",f)}finally{j(!1)}}return e.jsxs("main",{className:[A.statistics,L.dataDisplayMain].join(" "),children:[e.jsx(G,{dateRange:g,dates:m,setDates:b,sectionTitle:"WorcDSA Membership Statistics"}),t?h||_?e.jsx("p",{children:"Loading statistics..."}):e.jsxs("div",{className:A.asideContainer,children:[e.jsxs("aside",{className:A.numbersAside,children:[e.jsx("h2",{children:"Percent Change Over Time"}),e.jsx("div",{className:A.chartContainer,children:e.jsx(z,{data:d,type:"Table"})})]}),e.jsxs("aside",{className:A.chartAside,children:[e.jsx("h2",{children:"Area Chart of Membership Trends"}),e.jsx("div",{className:A.chartContainer,children:e.jsx(z,{data:r,type:"AreaChart"})})]})]}):e.jsx("p",{children:"Membership statistics not found."})]})}const ze="_error_1tgho_29",Je="_loginPage_1tgho_45",Ge="_loginContainer_1tgho_61",Y={error:ze,loginPage:Je,loginContainer:Ge};function K({onLoginSuccess:t,setAccessToken:n,setRefreshToken:c}){const[s,r]=o.useState(""),[l,h]=o.useState(""),[u,d]=o.useState(""),p=C.useNavigate(),_=q.get("csrftoken"),j=async m=>{m.preventDefault();try{const b=await E.post("/api/login/",{username:s,password:l},{headers:{"X-CSRFToken":_},withCredentials:!0});d(null),n(b.data.access),c(b.data.refresh),p("/app/search"),t(),console.log("navigating")}catch(b){console.error("Login failed:",b);const g=b?.data?.error||b?.data?.detail||b?.message||b?.data||"Login failed due to an unknown error.";d(g)}};return e.jsx("main",{className:Y.loginPage,children:e.jsxs("form",{className:Y.loginContainer,onSubmit:j,children:[e.jsxs("div",{className:Y.error,style:{display:u?"block":"none"},children:["Error: ",u+"."]}),e.jsx(J,{}),e.jsx("label",{htmlFor:"username",children:"Username: "}),e.jsx("input",{htmlFor:"username",type:"username",onChange:m=>r(m.target.value)}),e.jsx("label",{htmlFor:"password",children:"Password: "}),e.jsx("input",{htmlFor:"password",type:"password",onChange:m=>h(m.target.value)}),e.jsx("button",{className:B.redButton,children:"Log in"})]})})}function Ke({onLogoutSuccess:t}){return t(),e.jsx(K,{})}function Qe(){const{memberId:t}=C.useParams(),{members:n,isLoading:c}=o.useContext(U),[s,r]=o.useState(null),[l,h]=o.useState(!1);return o.useEffect(()=>{const u=n.find(d=>d.pk.toString()===t);if(u)r(u);else{async function d(){h(!0);try{const _=await(await fetch(`/api/${t}/data`)).json();r(JSON.parse(_))}catch(p){console.error("Failed to fetch member data",p)}finally{h(!1)}}d()}},[t,n]),c||l?e.jsx("p",{children:"Loading member details..."}):s?e.jsx("div",{className:I.cardContainer,children:e.jsxs("div",{className:I.memberCardFull,children:[e.jsxs("h1",{children:[s.fields.first_name," ",s.fields.last_name]}),e.jsxs("section",{for:"committees_and_unions",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Committee:"}),s.fields.committee.length===0?" N/A":s.fields.committee]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union member:"})," ",s.fields.union_member]}),s.fields.union_name===""?e.jsx("span",{}):e.jsxs("p",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Union name:"})," ",s.fields.union_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union local?:"})," ",s.fields.union_local]})]})]}),e.jsxs("section",{for:"contact",children:[e.jsx("h2",{children:"Contact information"}),e.jsxs("div",{children:[e.jsx("b",{children:"Best phone number:"})," ",s.fields.best_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile phone:"})," ",s.fields.mobile_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.fields.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord:"})," ",s.fields.discord_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord status:"})," ",s.fields.discord_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mailing address:"})," ",s.fields.address1,","," ",s.fields.city," ",s.fields.zip,", ",s.fields.country]})]}),e.jsxs("section",{for:"membership_info",children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",s.fields.membership_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"DSA Chapter:"})," ",s.fields.dsa_chapter]}),e.jsxs("div",{children:[e.jsx("b",{children:"Membership type:"})," ",s.fields.membership_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Joined in the past month?:"}),s.fields.new_member_past_month]}),e.jsxs("div",{children:[e.jsx("b",{children:"Monthly dues status:"})," ",s.fields.monthly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Yearly dues status:"})," ",s.fields.yearly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Join Date:"})," ",s.fields.join_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Expiry Date:"})," ",s.fields.xdate]})]})]})}):e.jsx("p",{children:"Member not found."})}const Xe=async(t,n,c,s)=>{try{const r=await E.get("/api/validate-token/",{headers:{Authorization:`Bearer ${t}`},withCredentials:!1});return!0}catch(r){if(r.response?.status===401&&s)try{const l=await E.post("api/validate-refresh-token/",{refresh:n},{withCredentials:!1});return c(l.data.access),!0}catch{return!1}}},O=({children:t,isValid:n,token:c})=>!c||!n?(c||console.log("no token found"),n||console.log("invalid token"),e.jsx(C.Navigate,{to:"/app/login",replace:!0})):t;function qe({data:t}){const{new_values:n,updated_values:c,deleted_values:s}=t,r=(u,d)=>Object.entries(u).map(([p,_])=>{const j=d==="updated"?_.current_values:_;return{id:p,first_name:j.first_name,last_name:j.last_name,email:j.email,change_field:d==="updated"?Object.keys(_.updated_values).join(", "):"",change_from:d==="updated"?Object.values(_.updated_values).map(([m])=>m).join(","):"",change_to:d==="updated"?Object.values(_.updated_values).map(([m,b])=>b).join(","):"",type:d}}),l=[...r(n,"new"),...r(s,"deleted"),...r(c,"updated")];console.log(l);const h=l.map(u=>{const d={};for(const[p,_]of Object.entries(u))d[p]=_===void 0?"":_;return d});return t?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Last Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Change Type"}),e.jsx("th",{children:"Change Field"}),e.jsx("th",{children:"Change From"}),e.jsx("th",{children:"Change To"})]})}),e.jsx("tbody",{children:h.map(({id:u,first_name:d,last_name:p,email:_,type:j,change_field:m,change_from:b,change_to:g})=>{const a=(m||"").split(", ").filter(Boolean),i=(b||"").split(",").filter(Boolean),x=(g||"").split(",").filter(Boolean);return e.jsxs(o.Fragment,{children:[e.jsxs("tr",{className:L[j],children:[e.jsx("td",{children:(j=="updated",d)}),e.jsx("td",{children:(j=="updated",p)}),e.jsx("td",{children:(j=="updated",_)}),e.jsx("td",{children:j}),e.jsx("td",{children:a[0]||""}),e.jsx("td",{children:i[0]||""}),e.jsx("td",{children:x[0]||""})]}),j==="updated"&&a.slice(1).map((v,y)=>e.jsxs("tr",{className:L[j],children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:v}),e.jsx("td",{children:i[y+1]||""}),e.jsx("td",{children:x[y+1]||""})]},`${u}-${v}`))]},u)})})]}):e.jsx("div",{children:"Data not found for that range."})}function Ze(){const[t,n]=o.useState([]),[c,s]=o.useState([]),[r,l]=o.useState([]),[h,u]=o.useState(!0),[d,p]=o.useState(!1),[_,j]=o.useState(!0);function m(){const a=new Date,i=new Date(a);i.setDate(a.getDate()-7);const x=D=>D.toISOString().split("T")[0],v=x(a),y=x(i);n([y,v]),console.log("in setDefaultDates:",[y,v])}o.useEffect(()=>{m(),g()},[]),o.useEffect(()=>{t.length===2&&(b(),console.log("Dates",t))},[t]);async function b(){console.log("in fetchMembershipData:"),p(!1),j(!0);const a=v=>v instanceof Date?v.toISOString().split("T")[0]:v,i=a(t[0]),x=a(t[1]);try{const v=await fetch(`/api/membership-updates/${i}/${x}`);if(!v.ok){const D=await v.text();throw p(!0),new Error(`Server error ${v.status}: ${D}`)}const y=await v.json();l(y)}catch(v){console.error("Failed to fetch membership updates",v)}finally{j(!1)}}async function g(){u(!0);try{const x=(await(await fetch("/api/earliest_listdate/")).json()).earliest_date;console.log("earliest ",x);const D=(f=>f.toISOString().split("T")[0])(new Date);console.log("todayStr",D),s([x,D])}catch(a){console.error("Failed to fetch earliest date",a)}finally{u(!1)}}return e.jsx("main",{className:[L.memberWeeklies,L.dataDisplayMain].join(" "),children:e.jsxs("section",{className:L.tableContainer,children:[e.jsx(G,{dateRange:c,dates:t,setDates:n,sectionTitle:"Membership Changes"}),d?e.jsx("p",{children:"Data not found for that date range. Try inputting a different range."}):_||h?e.jsx("p",{children:"Loading data..."}):e.jsx(qe,{data:r})]})})}function et(){const[t,n]=o.useState(null),[c,s]=o.useState(null),[r,l]=o.useState(null),[h,u]=o.useState(!0);o.useEffect(()=>{(async()=>{let j=c;if(!j)try{j=(await E.post("api/validate-refresh-token/",{},{withCredentials:!0})).data.access,s(j)}catch(m){console.log("Token refresh failed:",m.response?.data||m.message)}if(j){const m=await Xe(j,r,l,s);n(m)}else n(!1);u(!1)})()},[]);const d=1e3*60*5,p=()=>{s(null),l(null),n(!1)};return h?e.jsx("div",{children:"Checking authentication..."}):e.jsxs(C.BrowserRouter,{children:[t&&e.jsx(Fe,{}),e.jsxs(C.Routes,{children:[e.jsx(C.Route,{path:"/",element:e.jsx(C.Navigate,{to:"/app/search",replace:!0})}),e.jsx(C.Route,{path:"/app/search",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx($,{children:e.jsx(Ae,{})})})})}),e.jsx(C.Route,{path:"/app/statistics",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx($,{children:e.jsx(We,{})})})})}),e.jsx(C.Route,{path:"/app/weeklies",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx($,{children:e.jsx(Ze,{})})})})}),e.jsx(C.Route,{path:"/app/members/:memberId",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:p,children:e.jsx($,{children:e.jsx(Qe,{})})})})}),e.jsx(C.Route,{path:"/app/logout",element:e.jsx(O,{isValid:t,token:c,children:e.jsx(Ke,{onLogoutSuccess:()=>n(!1)})})}),e.jsx(C.Route,{path:"/app/login",element:e.jsx(K,{onLoginSuccess:()=>n(!0),setAccessToken:s,setRefreshToken:l})}),e.jsx(C.Route,{path:"*",element:t?e.jsx(Le,{}):e.jsx(C.Navigate,{to:"/app/login",replace:!0})})]})]})}Z.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(et,{})}));
