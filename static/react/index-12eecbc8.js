import{j as E,r as d,m as C,D as G,a as L,C as K,b as P,c as W,R as Q}from"./vendor-8dbdfeb8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function c(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=c(i);fetch(i.href,l)}})();const q=E.Fragment,e=E.jsx,s=E.jsxs,T=d.createContext();function X({children:n}){const[t,c]=d.useState([]),[r,i]=d.useState(!0);return d.useEffect(()=>{async function l(){try{const f=await(await fetch("/api/data")).json();c(JSON.parse(f))}catch(u){console.error("Failed to fetch members",u)}finally{i(!1)}}l()},[]),e(T.Provider,{value:{members:t,isLoading:r},children:n})}const Z="_memberCard_26899_1",ee="_memberTitle_26899_13",te="_cardContainer_26899_1",ne="_memberCardFull_26899_63",V={memberCard:Z,memberTitle:ee,cardContainer:te,memberCardFull:ne};function re({memberId:n,fields:t}){return s("div",{className:V.memberCard,children:[s(C.Link,{to:`/app/members/${n}`,state:{memberFields:t},className:V.memberTitle,children:[s("span",{children:[t.first_name," "]})," ",e("span",{children:t.last_name})," ",s("span",{children:[" - ",t.membership_status]})]}),s("div",{children:["Join date: ",t.join_date]}),s("div",{children:["Expiry date: ",t.xdate]}),s("div",{children:["Email: ",t.email]}),s("div",{children:["Address: ",t.address1," ",t.address2,", ",t.city," ",t.state," ",t.vaccinated]})]})}const se="_fullPage_7eejv_1",ae="_searchBar_7eejv_13",ie="_inactive_7eejv_33",oe="_active_7eejv_41",ce="_buttonsContainer_7eejv_49",le="_toggleAdvancedSearch_7eejv_59",de="_filterSideBar_7eejv_71",ue="_content_7eejv_89",he="_membersList_7eejv_113",me="_hidden_7eejv_127",F={fullPage:se,searchBar:ae,inactive:ie,active:oe,buttonsContainer:ce,toggleAdvancedSearch:le,filterSideBar:de,content:ue,membersList:he,hidden:me};function fe({name:n,setQuery:t}){function c(r){return r==="address1"?"Address: ":r.charAt(0).toUpperCase()+r.slice(1).replaceAll("_"," ")+": "}return s("div",{className:F.filterField,children:[e("label",{children:`${c(n)}`}),e("input",{id:`adv_${n}`,type:"text",onChange:r=>t(n,r.target.value)})]})}function j({name:n,selectOptions:t=[],setQuery:c}){function r(i){return i==="student_yes_no"?"Student?: ":i.charAt(0).toUpperCase()+i.slice(1).replaceAll("_"," ")+": "}return s("div",{className:F.filterField,children:[e("label",{children:`${r(n)}`}),e("select",{id:`adv_${n}`,name:`adv_${n}`,onChange:i=>c(n,i.target.value),children:t.map(i=>e("option",{value:i,children:i},`adv_${i}`))})]})}function I({name:n,setQuery:t,resetDates:c,defaultDate:r,datesRange:i}){const[l,u]=d.useState(r||new Date),[f,b]=d.useState([]),[p,g]=d.useState(!1);function D(o){return o==="xdate_before"?"Membership expires before: ":o=="xdate_after"?"Membership expires after: ":o==="join_date_after"?"Joined after: ":o==="join_date_before"?"Joined before: ":o.charAt(0).toUpperCase()+o.slice(1).replaceAll("_"," ")+": "}function S(o,y){u(y),t(o,y),g(!0)}d.useEffect(()=>{u(new Date),g(!1)},[c]),d.useEffect(()=>{f.length===0&&i!==void 0&&b(N(i))},[i]);function N(o){return o.map(y=>typeof y=="string"?_(y):y)}function _(o){return new Date(o.replace("-","/"))}d.useEffect(()=>{if(r){let o=r;typeof r=="string"&&(o=_(o),S(n,o)),u(o)}},[r]);function a(){g(!0)}return s("div",{children:[e("label",{children:`${D(n)}`}),e(G,{className:p?F.active:F.inactive,selected:l,onChange:o=>S(n,o),onCalendarOpen:a,includeDateIntervals:i?[{start:f[0],end:f[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const _e="_redButton_ta6ja_101",pe="_whiteButton_ta6ja_119",x={redButton:_e,whiteButton:pe};function be({setStateParameters:n,isVisible:t}){const[c,r]=d.useState({}),[i,l]=d.useState(!1),u=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],f=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],b=["join_date_before","join_date_after","xdate_before","xdate_after"],p=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],g=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],D=["","Member","Member in Good Standing","Lapsed"];function S(a,o){o=o.toString().toLowerCase(),a==="union_member"&&(o=o==="true"?"yes":"no"),r(y=>({...y,[a]:o}))}function N(a){a.preventDefault(),n(c)}function _(){document.querySelector("#advancedFilterForm").reset(),r({}),n({}),l(a=>!a)}return e("aside",{className:F.filterSideBar,children:t&&s("form",{id:"advancedFilterForm",style:{display:t?"block":"none"},onSubmit:a=>N(a),children:[u.map(a=>f.includes(a)?e(fe,{name:a,setQuery:S},`component_${a}`):p.includes(a)?e(j,{name:a,selectOptions:["","True","False"],setQuery:S},`component_${a}`):b.includes(a)?e(I,{name:a,setQuery:S,resetDates:i,setResetDates:l},`component_${a}_${i}`):a==="membership_status"?e(j,{name:a,selectOptions:D,setQuery:S},`component_${a}`):a==="student_yes_no"?e(j,{name:a,selectOptions:["","Yes","No"],setQuery:S},`component_${a}`):a==="mailing_pref"?e(j,{name:a,selectOptions:["","Yes","No"],setQuery:S},`component_${a}`):a==="state"?e(j,{name:a,selectOptions:g,setQuery:S},`component_${a}`):console.log("unrecognized field; how'd you manage this?")),s("div",{className:F.buttonsContainer,children:[e("button",{onClick:N,className:x.redButton,children:"Search"}),e("button",{onClick:_,className:x.whiteButton,children:"Clear filters"})]})]})})}const ge="_Search_6hey7_1",ve="_searchForm_6hey7_9",ye="_searchButton_6hey7_19",O={Search:ge,searchForm:ve,searchButton:ye};function Ce({setStateParameters:n,query:t,setQuery:c,setReRender:r,reRender:i}){function l(u){u.preventDefault();const f={};if(n({}),t.includes(":")){const b=t.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(b);for(let p=0;p<b.length-1;p+=2){const g=b[p],D=b[p+1];f[g]=D}n(f)}r(!i)}return s("form",{className:O.searchForm,onSubmit:u=>l(u),children:[e("input",{value:t,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:u=>c(u.target.value),type:"text",className:O.Search}),e("button",{className:`${x.redButton} ${O.searchButton}`,children:"Go!"})]})}function Se({MemberList:n=[]}){const[t,c]=d.useState(""),[r,i]=d.useState({}),[l,u]=d.useState(!1),[f,b]=d.useState(!1),p=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],g=()=>{b(_=>!_)},D=n.filter(_=>{const a=_.fields;let o={...r};const y=Object.keys(o).length;if(!y&&t!==""){for(const h in a){const m=a[h];if(m&&m.toString().toLowerCase().includes(t.toLowerCase()))return!0}return!1}else{if(!y&&t==="")return!0;if(y>0){if(p.some(({before:m,after:v})=>m in o||v in o)&&!N(a,o)||o.address1&&!S(a,o))return!1;for(const m of Object.keys(o)){const v=o[m];if(!(a[m]!==null?a[m].toString().toLowerCase():"").includes(v))return!1}return!0}}});function S(_,a){return!!(_.address1.includes(a.address1)||_.address2.includes(a.address1))}function N(_,a){let o=!0;for(const{base:y,before:h,after:m}of p){const v=a[h],A=a[m];v&&A?o=o&&L(_[y]).isBetween(a[m],a[h]):v?o=o&&L(_[y]).isBefore(a[h]):A&&(o=o&&L(_[y]).isAfter(a[m])),v&&delete a[h],A&&delete a[m]}return o}return s("div",{className:F.fullPage,children:[s("header",{className:F.searchBar,children:[e(Ce,{setStateParameters:i,query:t,setQuery:c,setReRender:u,reRender:l}),s("a",{className:F.toggleAdvancedSearch,onClick:g,children:[f?"Close":"Open"," advanced search"]})]}),s("div",{className:F.content,children:[e(be,{setStateParameters:i,isVisible:f}),e("main",{className:F.membersList,children:D.length>0?D.map(_=>e(re,{memberId:_.pk,fields:_.fields},_.pk)):e("li",{children:"No results found"})},l)]})]})}const De="_logoHeader_1iozh_1",Ne={logoHeader:De},Ae="/static/react/headerlogo-400x400-4e71439a.png";function z(){return s("header",{className:Ne.logoHeader,children:[e("img",{src:Ae}),s("h2",{children:["DSA ",e("br",{}),"Membership",e("br",{}),"Visualizer"]})]})}const Fe="_navBar_1cdgm_1",Le="_pageOptions_1cdgm_27",Y={navBar:Fe,pageOptions:Le};function Me(){return s("nav",{className:Y.navBar,children:[e(z,{}),s("div",{className:Y.pageOptions,children:[e("a",{href:"/admin/",children:"Admin"}),e(C.Link,{to:"/app/search",children:"Search"}),e(C.Link,{to:"/app/statistics",children:"Statistics"}),e(C.Link,{to:"/app/logout",children:"Log out"})]})]})}function we(){const{members:n,isLoading:t}=d.useContext(T);return t?e("p",{children:"Loading members..."}):e("div",{className:"MembersList",children:e(Se,{MemberList:n})})}function je(){return s("div",{children:["Page not found. Have you forgotten to log in to the ",e("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function H({data:n,type:t}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function r(i){const l=i[0].slice(1);let u=i[1],f=i[i.length-1],b=[u,f];const g=[["Metric",...[u[0],f[0]],"% Change"]];return l.forEach((D,S)=>{const N=b.map(A=>A[S+1]),_=N[0],a=N[N.length-1],o=_!==0?(a-_)/Math.abs(_)*100:0,y=o>0?"⬆️":o<0?"⬇️":"—",h=o<0?"red":o>0?"green":"black",m=`${y} <span style="color:${h};">${o.toFixed(2)}%</span>`,v=[D,...N,m];g.push(v)}),g}return!n||!Array.isArray(n)||n.length===0||n[0].length===0?e("p",{children:"Loading chart data..."}):e(K,{chartType:t,data:t==="Table"?r(n):n,options:c,legendToggle:!0})}const ke="_chartContainer_1m3i0_1",xe="_numbersAside_1m3i0_17",Be="_chartForm_1m3i0_29",$e="_chartAside_1m3i0_57",Oe="_statistics_1m3i0_77",Re="_inactive_1m3i0_129",Pe="_active_1m3i0_137",Ie="_container_1m3i0_1",M={chartContainer:ke,numbersAside:xe,chartForm:Be,chartAside:$e,statistics:Oe,inactive:Re,active:Pe,container:Ie};function U({asideName:n,dates:t,setDates:c}){const[r,i]=d.useState({});function l(f,b){i(p=>({...p,[f]:b}))}function u(f){f.preventDefault(),c(Object.values(r))}return s("form",{className:M.chartForm,children:[e(I,{name:`${n}_from`,setQuery:l,defaultDate:t[0],datesRange:t}),e(I,{name:`${n}_to`,setQuery:l,defaultDate:t[1],datesRange:t})," ",e("button",{className:x.redButton,onClick:f=>u(f),children:"Go!"})]})}function Ee(){const[n,t]=d.useState(null),[c,r]=d.useState(null),[i,l]=d.useState(null),[u,f]=d.useState(!0),[b,p]=d.useState([]),[g,D]=d.useState([]),[S,N]=d.useState([]),_=[];d.useEffect(()=>{async function h(){try{const v=await(await fetch("/api/membership_counts/")).json();t(v)}catch(m){console.error("Failed to fetch membershipCount",m)}finally{f(!1)}}h()},[]);function a(h){if(h.splice(2,1),h.splice(0,1),typeof h[1]=="string")for(let m=0;m<h.length;m++)h[m]=h[m].charAt(0).toUpperCase()+h[m].slice(1).replaceAll("_"," ");return h}function o(h){var m=h,v=m.sort(function(A,w){return Date.parse(A)>Date.parse(w)});p([v[0],v[v.length-1]]),D([v[0],v[v.length-1]])}d.useEffect(()=>{if(n){let h=Object.keys(n[0]),m=[];h=a(h),_.push(h);for(const v of n)m.push(v.list_date),h=Object.values(v),h=a(h),_.push(h);r(_),l(_),o(m)}},[n]),d.useEffect(()=>{b&&c&&y(b,"chart")},[b]),d.useEffect(()=>{g&&c&&y(g,"table")},[g]);function y(h,m){if(!h||Object.keys(h).length!==2||!c)return;const v=L(h[0]).format("YYYY-MM-DD"),A=L(h[1]).format("YYYY-MM-DD");let w=[c[0]];for(let B=1;B<c.length;B++){const $=L(c[B][0]).format("YYYY-MM-DD");(L($).isBetween(v,A)||L($).isSame(v)||L($).isSame(A))&&w.push(c[B])}m==="chart"&&l(w),m==="table"&&N(w)}return n?u?e("p",{children:"Loading statistics..."}):s("main",{className:M.statistics,children:[s("aside",{className:M.numbersAside,children:[e("h2",{children:"Percent Change Over Time"}),s("div",{className:M.chartContainer,children:[e(U,{dates:g,asideName:"chart",setDates:D}),e(H,{data:S,type:"Table"})]})]}),s("aside",{className:M.chartAside,children:[e("h1",{children:"Area Chart of Membership Trends"}),s("div",{className:M.chartContainer,children:[e(U,{dates:b,asideName:"chart",setDates:p}),e(H,{data:i,type:"AreaChart"})]})]})]}):e("p",{children:"Membership statistics not found."})}const Te="_root_1tgho_1",Ve="_inactive_1tgho_13",Ye="_active_1tgho_21",He="_error_1tgho_29",Ue="_loginPage_1tgho_45",ze="_loginContainer_1tgho_61",R={root:Te,inactive:Ve,active:Ye,error:He,loginPage:Ue,loginContainer:ze};function J({onLoginSuccess:n}){const[t,c]=d.useState(""),[r,i]=d.useState(""),[l,u]=d.useState(""),f=C.useNavigate(),b=async p=>{p.preventDefault();try{const g=await P.post("/api/login/",{username:t,password:r});u(null),localStorage.setItem("token",g.data.access),f("/app/search"),n()}catch(g){console.error("Login failed:",g.response.data),P.defaults.headers.common.Authorization=null,u(g.response.data.error)}};return e("main",{className:R.loginPage,children:s("form",{className:R.loginContainer,onSubmit:b,children:[s("div",{className:R.error,style:{display:l?"block":"none"},children:["Error: ",l+"."]}),e(z,{}),e("label",{htmlFor:"username",children:"Username: "}),e("input",{htmlFor:"username",type:"username",onChange:p=>c(p.target.value)}),e("label",{htmlFor:"password",children:"Password: "}),e("input",{htmlFor:"password",type:"password",onChange:p=>i(p.target.value)}),e("button",{className:x.redButton,children:"Log in"})]})})}function Je({onLogoutSuccess:n}){return localStorage.removeItem("token"),n(),e(J,{})}function Ge(){const{memberId:n}=C.useParams(),{members:t,isLoading:c}=d.useContext(T),[r,i]=d.useState(null),[l,u]=d.useState(!1);return d.useEffect(()=>{const f=t.find(b=>b.pk.toString()===n);if(f)i(f);else{async function b(){u(!0);try{const g=await(await fetch(`/api/${n}/data`)).json();i(JSON.parse(g))}catch(p){console.error("Failed to fetch member data",p)}finally{u(!1)}}b()}},[n,t]),c||l?e("p",{children:"Loading member details..."}):r?e("div",{id:"cardContainer",children:s("div",{className:"memberCardFull",children:[s("h1",{children:[r.fields.first_name," ",r.fields.last_name]}),s("section",{for:"committees_and_unions",children:[s("div",{children:[e("b",{children:"Committee:"}),r.fields.committee.length===0?" N/A":r.fields.committee]}),s("div",{children:[e("b",{children:"Union member:"})," ",r.fields.union_member]}),r.fields.union_name===""?e("span",{}):s("p",{children:[s("div",{children:[e("b",{children:"Union name:"})," ",r.fields.union_name]}),s("div",{children:[e("b",{children:"Union local?:"})," ",r.fields.union_local]})]})]}),s("section",{for:"contact",children:[e("h2",{children:"Contact information"}),s("div",{children:[e("b",{children:"Best phone number:"})," ",r.fields.best_phone]}),s("div",{children:[e("b",{children:"Mobile phone:"})," ",r.fields.mobile_phone]}),s("div",{children:[e("b",{children:"Email:"})," ",r.fields.email]}),s("div",{children:[e("b",{children:"Discord:"})," ",r.fields.discord_name]}),s("div",{children:[e("b",{children:"Discord status:"})," ",r.fields.discord_status]}),s("div",{children:[e("b",{children:"Mailing address:"})," ",r.fields.address1,","," ",r.fields.city," ",r.fields.zip,", ",r.fields.country]})]}),s("section",{for:"membership_info",children:[e("h2",{children:"Membership"}),s("div",{children:[e("b",{children:"Status:"})," ",r.fields.membership_status]}),s("div",{children:[e("b",{children:"DSA Chapter:"})," ",r.fields.dsa_chapter]}),s("div",{children:[e("b",{children:"Membership type:"})," ",r.fields.membership_type]}),s("div",{children:[e("b",{children:"Joined in the past month?:"}),r.fields.new_member_past_month]}),s("div",{children:[e("b",{children:"Monthly dues status:"})," ",r.fields.monthly_dues_status]}),s("div",{children:[e("b",{children:"Yearly dues status:"})," ",r.fields.yearly_dues_status]}),s("div",{children:[e("b",{children:"Join Date:"})," ",r.fields.join_date]}),s("div",{children:[e("b",{children:"Expiry Date:"})," ",r.fields.xdate]})]})]})}):e("p",{children:"Member not found."})}const Ke=async n=>{var t;try{const c=await P.get("/api/validate-token/",{headers:{Authorization:`Bearer ${n}`}});return console.log(c),!0}catch(c){return console.error("Invalid token:",((t=c.response)==null?void 0:t.data)||c.message),!1}},k=({children:n,isValid:t})=>{const c=localStorage.getItem("token");return!c||!t?(c||console.log("no token found"),t||console.log("invalid token"),e(C.Navigate,{to:"/login"})):n};function We(){const[n,t]=d.useState(null),[c,r]=d.useState(!0);return d.useEffect(()=>{(async()=>{const l=localStorage.getItem("token");if(l){const u=await Ke(l);t(u),u||localStorage.removeItem("token")}else t(!1);r(!1)})()},[]),c?e("div",{children:"Checking authentication..."}):e(C.BrowserRouter,{children:n?s(q,{children:[e(Me,{}),e(X,{children:s(C.Routes,{children:[e(C.Route,{path:"/",element:e(C.Navigate,{to:"/app/search",replace:!0})}),e(C.Route,{path:"/app/search",element:e(k,{isValid:n,children:e(we,{})})}),e(C.Route,{path:"/app/statistics",element:e(k,{isValid:n,children:e(Ee,{})})}),e(C.Route,{path:"/app/members/:memberId",element:e(k,{isValid:n,children:e(Ge,{})})}),e(C.Route,{path:"/app/logout",element:e(k,{isValid:n,children:e(Je,{onLogoutSuccess:()=>t(!1)})})}),e(C.Route,{path:"*",element:e(k,{isValid:n,children:e(je,{})})})]})})]}):s(C.Routes,{children:[e(C.Route,{path:"/app/login",element:e(J,{onLoginSuccess:()=>t(!0)})}),e(C.Route,{path:"*",element:e(C.Navigate,{to:"/app/login"})})]})})}W.createRoot(document.getElementById("root")).render(e(Q.StrictMode,{children:e(We,{})}));
