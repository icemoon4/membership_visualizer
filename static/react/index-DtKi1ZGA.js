import{r as i,j as e,m as C,D as K,a as F,C as Q,b as X,c as E,_ as R,R as Z,d as ee}from"./vendor-Fm9ckxW3.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function c(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=c(a);fetch(a.href,l)}})();const H=i.createContext();function $({children:t}){const[r,c]=i.useState([]),[s,a]=i.useState(!0);return i.useEffect(()=>{async function l(){try{const u=await(await fetch("/api/data")).json();c(JSON.parse(u))}catch(h){console.error("Failed to fetch members",h)}finally{a(!1)}}l()},[]),e.jsx(H.Provider,{value:{members:r,isLoading:s},children:t})}const te="_memberCard_186gy_1",se="_memberTitle_186gy_13",ne="_cardContainer_186gy_23",re="_memberCardFull_186gy_63",I={memberCard:te,memberTitle:se,cardContainer:ne,memberCardFull:re};function ae({memberId:t,fields:r}){return e.jsxs("div",{className:I.memberCard,children:[e.jsxs(C.Link,{to:`/app/members/${t}`,state:{memberFields:r},className:I.memberTitle,children:[e.jsxs("span",{children:[r.first_name," "]})," ",e.jsx("span",{children:r.last_name})," ",e.jsxs("span",{children:[" - ",r.membership_status]})]}),e.jsxs("div",{children:["Join date: ",r.join_date]}),e.jsxs("div",{children:["Expiry date: ",r.xdate]}),e.jsxs("div",{children:["Email: ",r.email]}),e.jsxs("div",{children:["Address: ",r.address1," ",r.address2,", ",r.city," ",r.state," ",r.vaccinated]})]})}const oe="_fullPage_7eejv_1",ie="_searchBar_7eejv_13",ce="_inactive_7eejv_33",le="_active_7eejv_41",de="_buttonsContainer_7eejv_49",he="_toggleAdvancedSearch_7eejv_59",ue="_filterSideBar_7eejv_71",me="_content_7eejv_89",fe="_membersList_7eejv_113",N={fullPage:oe,searchBar:ie,inactive:ce,active:le,buttonsContainer:de,toggleAdvancedSearch:he,filterSideBar:ue,content:me,membersList:fe};function je({name:t,setQuery:r}){function c(s){return s==="address1"?"Address: ":s.charAt(0).toUpperCase()+s.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${c(t)}`}),e.jsx("input",{id:`adv_${t}`,type:"text",onChange:s=>r(t,s.target.value)})]})}function k({name:t,selectOptions:r=[],setQuery:c}){function s(a){return a==="student_yes_no"?"Student?: ":a.charAt(0).toUpperCase()+a.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:N.filterField,children:[e.jsx("label",{children:`${s(t)}`}),e.jsx("select",{id:`adv_${t}`,name:`adv_${t}`,onChange:a=>c(t,a.target.value),children:r.map(a=>e.jsx("option",{value:a,children:a},`adv_${a}`))})]})}function U({name:t,setQuery:r,resetDates:c,defaultDate:s,datesRange:a}){const[l,h]=i.useState(s||new Date),[u,d]=i.useState([]),[j,x]=i.useState(!1);function p(o){return o==="xdate_before"?"Membership expires before: ":o=="xdate_after"?"Membership expires after: ":o==="join_date_after"?"Joined after: ":o==="join_date_before"?"Joined before: ":o.charAt(0).toUpperCase()+o.slice(1).replaceAll("_"," ")+": "}function m(o,_){h(_),r(o,_),x(!0)}i.useEffect(()=>{h(new Date),x(!1)},[c]),i.useEffect(()=>{u.length===0&&a!==void 0&&d(b(a))},[a]);function b(o){return o.map(_=>typeof _=="string"?g(_):_)}function g(o){return new Date(o.replace("-","/"))}i.useEffect(()=>{if(s){let o=s;typeof s=="string"&&(o=g(o),m(t,o)),h(o)}},[s]);function n(){x(!0)}return e.jsxs("div",{children:[e.jsx("label",{children:`${p(t)}`}),e.jsx(K,{className:j?N.active:N.inactive,selected:l,onChange:o=>m(t,o),onCalendarOpen:n,includeDateIntervals:a?[{start:u[0],end:u[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const pe="_redButton_ta6ja_101",xe="_whiteButton_ta6ja_119",B={redButton:pe,whiteButton:xe};function _e({setStateParameters:t,isVisible:r}){const[c,s]=i.useState({}),[a,l]=i.useState(!1),h=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],u=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],d=["join_date_before","join_date_after","xdate_before","xdate_after"],j=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],x=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],p=["","Member","Member in Good Standing","Lapsed"];function m(n,o){o=o.toString().toLowerCase(),n==="union_member"&&(o=o==="true"?"yes":"no"),s(_=>({..._,[n]:o}))}function b(n){n.preventDefault(),t(c)}function g(){document.querySelector("#advancedFilterForm").reset(),s({}),t({}),l(n=>!n)}return e.jsx("aside",{className:N.filterSideBar,children:r&&e.jsxs("form",{id:"advancedFilterForm",style:{display:r?"block":"none"},onSubmit:n=>b(n),children:[h.map(n=>u.includes(n)?e.jsx(je,{name:n,setQuery:m},`component_${n}`):j.includes(n)?e.jsx(k,{name:n,selectOptions:["","True","False"],setQuery:m},`component_${n}`):d.includes(n)?e.jsx(U,{name:n,setQuery:m,resetDates:a,setResetDates:l},`component_${n}_${a}`):n==="membership_status"?e.jsx(k,{name:n,selectOptions:p,setQuery:m},`component_${n}`):n==="student_yes_no"?e.jsx(k,{name:n,selectOptions:["","Yes","No"],setQuery:m},`component_${n}`):n==="mailing_pref"?e.jsx(k,{name:n,selectOptions:["","Yes","No"],setQuery:m},`component_${n}`):n==="state"?e.jsx(k,{name:n,selectOptions:x,setQuery:m},`component_${n}`):console.log("unrecognized field; how'd you manage this?")),e.jsxs("div",{className:N.buttonsContainer,children:[e.jsx("button",{onClick:b,className:B.redButton,children:"Search"}),e.jsx("button",{onClick:g,className:B.whiteButton,children:"Clear filters"})]})]})})}const ge="_Search_6hey7_1",be="_searchForm_6hey7_9",ve="_searchButton_6hey7_19",V={Search:ge,searchForm:be,searchButton:ve};function ye({setStateParameters:t,query:r,setQuery:c,setReRender:s,reRender:a}){function l(h){h.preventDefault();const u={};if(t({}),r.includes(":")){const d=r.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(d);for(let j=0;j<d.length-1;j+=2){const x=d[j],p=d[j+1];u[x]=p}t(u)}s(!a)}return e.jsxs("form",{className:V.searchForm,onSubmit:h=>l(h),children:[e.jsx("input",{value:r,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:h=>c(h.target.value),type:"text",className:V.Search}),e.jsx("button",{className:`${B.redButton} ${V.searchButton}`,children:"Go!"})]})}function Ce({MemberList:t=[]}){const[r,c]=i.useState(""),[s,a]=i.useState({}),[l,h]=i.useState(!1),[u,d]=i.useState(!1),j=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],x=()=>{d(g=>!g)},p=t.filter(g=>{const n=g.fields;let o={...s};const _=Object.keys(o).length;if(!_&&r!==""){for(const v in n){const y=n[v];if(y&&y.toString().toLowerCase().includes(r.toLowerCase()))return!0}return!1}else{if(!_&&r==="")return!0;if(_>0){if(j.some(({before:y,after:D})=>y in o||D in o)&&!b(n,o)||o.address1&&!m(n,o))return!1;for(const y of Object.keys(o)){const D=o[y];if(!(n[y]!==null?n[y].toString().toLowerCase():"").includes(D))return!1}return!0}}});function m(g,n){return!!(g.address1.includes(n.address1)||g.address2.includes(n.address1))}function b(g,n){let o=!0;for(const{base:_,before:v,after:y}of j){const D=n[v],f=n[y];D&&f?o=o&&F(g[_]).isBetween(n[y],n[v]):D?o=o&&F(g[_]).isBefore(n[v]):f&&(o=o&&F(g[_]).isAfter(n[y])),D&&delete n[v],f&&delete n[y]}return o}return e.jsxs("div",{className:N.fullPage,children:[e.jsxs("header",{className:N.searchBar,children:[e.jsx(ye,{setStateParameters:a,query:r,setQuery:c,setReRender:h,reRender:l}),e.jsxs("a",{className:N.toggleAdvancedSearch,onClick:x,children:[u?"Close":"Open"," advanced search"]})]}),e.jsxs("div",{className:N.content,children:[e.jsx(_e,{setStateParameters:a,isVisible:u}),e.jsx("main",{className:N.membersList,children:p.length>0?p.map(g=>e.jsx(ae,{memberId:g.pk,fields:g.fields},g.pk)):e.jsx("li",{children:"No results found"})},l)]})]})}const Se="_logoHeader_1iozh_1",De={logoHeader:Se},we="/static/react/headerlogo-400x400-vDrkEIdg.png";function J(){return e.jsxs("header",{className:De.logoHeader,children:[e.jsx("img",{src:we}),e.jsxs("h2",{children:["DSA ",e.jsx("br",{}),"Membership",e.jsx("br",{}),"Visualizer"]})]})}const Ne="_navBar_1cdgm_1",Fe="_pageOptions_1cdgm_27",W={navBar:Ne,pageOptions:Fe};function Me(){return e.jsxs("nav",{className:W.navBar,children:[e.jsx(J,{}),e.jsxs("div",{className:W.pageOptions,children:[e.jsx("a",{href:"/admin/",children:"Admin"}),e.jsx(C.Link,{to:"/app/search",children:"Search"}),e.jsx(C.Link,{to:"/app/statistics",children:"Statistics"}),e.jsx(C.Link,{to:"/app/weeklies",children:"Membership Changes"}),e.jsx(C.Link,{to:"/app/logout",children:"Log out"})]})]})}function Le(){const{members:t,isLoading:r}=i.useContext(H);return r?e.jsx("p",{children:"Loading members..."}):e.jsx("div",{className:"MembersList",children:e.jsx(Ce,{MemberList:t})})}function Ae(){return e.jsxs("div",{children:["Page not found. Have you forgotten to log in to the ",e.jsx("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function z({data:t,type:r}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function s(a){const l=a[0].slice(1);let h=a[1],u=a[a.length-1],d=[h,u];const x=[["Metric",...[h[0],u[0]],"% Change"]];return l.forEach((p,m)=>{const b=d.map(f=>f[m+1]),g=b[0],n=b[b.length-1],o=g!==0?(n-g)/Math.abs(g)*100:0,_=o>0?"⬆️":o<0?"⬇️":"—",v=o<0?"red":o>0?"green":"black",y=`${_} <span style="color:${v};">${o.toFixed(2)}%</span>`,D=[p,...b,y];x.push(D)}),x}return!t||!Array.isArray(t)||t.length===0||t[0].length===0?e.jsx("p",{children:"Loading chart data..."}):e.jsx(Q,{chartType:r,data:r==="Table"?s(t):t,options:c,legendToggle:!0})}const ke="_chartContainer_1rjw7_1",Te="_numbersAside_1rjw7_17",Oe="_chartForm_1rjw7_29",Be="_chartAside_1rjw7_61",Re="_statistics_1rjw7_81",$e="_asideContainer_1rjw7_119",L={chartContainer:ke,numbersAside:Te,chartForm:Oe,chartAside:Be,statistics:Re,asideContainer:$e};function q({asideName:t,datesRange:r,defaultDates:c,setDates:s}){const[a,l]=i.useState({});function h(d,j){l(x=>({...x,[d]:j}))}function u(d){d.preventDefault(),s(Object.values(a))}return e.jsxs("form",{className:L.chartForm,children:[e.jsx(U,{name:"From",setQuery:h,defaultDate:c[0],datesRange:r}),e.jsx(U,{name:"to",setQuery:h,defaultDate:c[1],datesRange:r})," ",e.jsx("button",{className:B.redButton,onClick:d=>u(d),children:"Go!"})]})}function Ee(){const[t,r]=i.useState(null),[c,s]=i.useState(null),[a,l]=i.useState(null),[h,u]=i.useState(!0),[d,j]=i.useState([]),[x,p]=i.useState(!0),[m,b]=i.useState([]),[g,n]=i.useState([]),o=[];i.useEffect(()=>{async function f(){try{const w=await(await fetch("/api/membership_counts/")).json();r(w)}catch(S){console.error("Failed to fetch membershipCount",S)}finally{u(!1)}}f()},[]);function _(f){if(f.splice(2,1),f.splice(0,1),typeof f[1]=="string")for(let S=0;S<f.length;S++)f[S]=f[S].charAt(0).toUpperCase()+f[S].slice(1).replaceAll("_"," ");return f}function v(f){var S=f,w=S.sort(function(M,A){return Date.parse(M)>Date.parse(A)});b([w[0],w[w.length-1]])}i.useEffect(()=>{if(t){let f=Object.keys(t[0]),S=[];f=_(f),o.push(f);for(const w of t)S.push(w.list_date),f=Object.values(w),f=_(f),o.push(f);s(o),l(o),v(S)}},[t]),i.useEffect(()=>{m&&c&&y(m)},[m]),i.useEffect(()=>{D()},[]);function y(f){if(!f||Object.keys(f).length!==2||!c)return;const S=F(f[0]).format("YYYY-MM-DD"),w=F(f[1]).format("YYYY-MM-DD");let M=[c[0]];for(let A=1;A<c.length;A++){const P=F(c[A][0]).format("YYYY-MM-DD");(F(P).isBetween(S,w)||F(P).isSame(S)||F(P).isSame(w))&&M.push(c[A])}l(M),j(M)}async function D(){p(!0);try{const S=await(await fetch("/api/earliest_listdate/")).json(),w=S.earliest_date,M=S.latest_date;n([w,M])}catch(f){console.error("Failed to fetch earliest date",f)}finally{p(!1)}}return t?h||x?e.jsx("p",{children:"Loading statistics..."}):e.jsxs("main",{className:L.statistics,children:[e.jsx(q,{datesRange:g,defaultDates:m,asideName:"chart",setDates:b}),e.jsxs("div",{className:L.asideContainer,children:[e.jsxs("aside",{className:L.numbersAside,children:[e.jsx("h2",{children:"Percent Change Over Time"}),e.jsx("div",{className:L.chartContainer,children:e.jsx(z,{data:d,type:"Table"})})]}),e.jsxs("aside",{className:L.chartAside,children:[e.jsx("h2",{children:"Area Chart of Membership Trends"}),e.jsx("div",{className:L.chartContainer,children:e.jsx(z,{data:a,type:"AreaChart"})})]})]})]}):e.jsx("p",{children:"Membership statistics not found."})}const Ie="_error_1tgho_29",Pe="_loginPage_1tgho_45",Ve="_loginContainer_1tgho_61",Y={error:Ie,loginPage:Pe,loginContainer:Ve};function G({onLoginSuccess:t,setAccessToken:r,setRefreshToken:c}){const[s,a]=i.useState(""),[l,h]=i.useState(""),[u,d]=i.useState(""),j=C.useNavigate(),x=X.get("csrftoken"),p=async m=>{m.preventDefault();try{const b=await E.post("/api/login/",{username:s,password:l},{headers:{"X-CSRFToken":x},withCredentials:!0});d(null),r(b.data.access),c(b.data.refresh),j("/app/search"),t(),console.log("navigating")}catch(b){console.error("Login failed:",b);const g=b?.data?.error||b?.data?.detail||b?.message||b?.data||"Login failed due to an unknown error.";d(g)}};return e.jsx("main",{className:Y.loginPage,children:e.jsxs("form",{className:Y.loginContainer,onSubmit:p,children:[e.jsxs("div",{className:Y.error,style:{display:u?"block":"none"},children:["Error: ",u+"."]}),e.jsx(J,{}),e.jsx("label",{htmlFor:"username",children:"Username: "}),e.jsx("input",{htmlFor:"username",type:"username",onChange:m=>a(m.target.value)}),e.jsx("label",{htmlFor:"password",children:"Password: "}),e.jsx("input",{htmlFor:"password",type:"password",onChange:m=>h(m.target.value)}),e.jsx("button",{className:B.redButton,children:"Log in"})]})})}function Ye({onLogoutSuccess:t}){return t(),e.jsx(G,{})}function Ue(){const{memberId:t}=C.useParams(),{members:r,isLoading:c}=i.useContext(H),[s,a]=i.useState(null),[l,h]=i.useState(!1);return i.useEffect(()=>{const u=r.find(d=>d.pk.toString()===t);if(u)a(u);else{async function d(){h(!0);try{const x=await(await fetch(`/api/${t}/data`)).json();a(JSON.parse(x))}catch(j){console.error("Failed to fetch member data",j)}finally{h(!1)}}d()}},[t,r]),c||l?e.jsx("p",{children:"Loading member details..."}):s?e.jsx("div",{className:I.cardContainer,children:e.jsxs("div",{className:I.memberCardFull,children:[e.jsxs("h1",{children:[s.fields.first_name," ",s.fields.last_name]}),e.jsxs("section",{for:"committees_and_unions",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Committee:"}),s.fields.committee.length===0?" N/A":s.fields.committee]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union member:"})," ",s.fields.union_member]}),s.fields.union_name===""?e.jsx("span",{}):e.jsxs("p",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Union name:"})," ",s.fields.union_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union local?:"})," ",s.fields.union_local]})]})]}),e.jsxs("section",{for:"contact",children:[e.jsx("h2",{children:"Contact information"}),e.jsxs("div",{children:[e.jsx("b",{children:"Best phone number:"})," ",s.fields.best_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile phone:"})," ",s.fields.mobile_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.fields.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord:"})," ",s.fields.discord_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord status:"})," ",s.fields.discord_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mailing address:"})," ",s.fields.address1,","," ",s.fields.city," ",s.fields.zip,", ",s.fields.country]})]}),e.jsxs("section",{for:"membership_info",children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",s.fields.membership_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"DSA Chapter:"})," ",s.fields.dsa_chapter]}),e.jsxs("div",{children:[e.jsx("b",{children:"Membership type:"})," ",s.fields.membership_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Joined in the past month?:"}),s.fields.new_member_past_month]}),e.jsxs("div",{children:[e.jsx("b",{children:"Monthly dues status:"})," ",s.fields.monthly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Yearly dues status:"})," ",s.fields.yearly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Join Date:"})," ",s.fields.join_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Expiry Date:"})," ",s.fields.xdate]})]})]})}):e.jsx("p",{children:"Member not found."})}const He=async(t,r,c,s)=>{try{const a=await E.get("/api/validate-token/",{headers:{Authorization:`Bearer ${t}`},withCredentials:!1});return!0}catch(a){if(a.response?.status===401&&s)try{const l=await E.post("api/validate-refresh-token/",{refresh:r},{withCredentials:!1});return c(l.data.access),!0}catch{return!1}}},T=({children:t,isValid:r,token:c})=>!c||!r?(c||console.log("no token found"),r||console.log("invalid token"),e.jsx(C.Navigate,{to:"/app/login",replace:!0})):t,We="_updated_q15x0_17",ze="_deleted_q15x0_33",Je="_memberWeeklies_q15x0_55",qe="_tableContainer_q15x0_71",Ge="_tableTitle_q15x0_117",O={new:"_new_q15x0_1",updated:We,deleted:ze,memberWeeklies:Je,tableContainer:qe,tableTitle:Ge};function Ke({data:t}){const{new_values:r,updated_values:c,deleted_values:s}=t,a=(u,d)=>Object.entries(u).map(([j,x])=>{const p=d==="updated"?x.current_values:x;return{id:j,first_name:p.first_name,last_name:p.last_name,email:p.email,change_field:d==="updated"?Object.keys(x.updated_values).join(", "):"",change_from:d==="updated"?Object.values(x.updated_values).map(([m])=>m).join(","):"",change_to:d==="updated"?Object.values(x.updated_values).map(([m,b])=>b).join(","):"",type:d}}),l=[...a(r,"new"),...a(s,"deleted"),...a(c,"updated")];console.log(l);const h=l.map(u=>{const d={};for(const[j,x]of Object.entries(u))d[j]=x===void 0?"":x;return d});return t?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Last Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Change Type"}),e.jsx("th",{children:"Change Field"}),e.jsx("th",{children:"Change From"}),e.jsx("th",{children:"Change To"})]})}),e.jsx("tbody",{children:h.map(({id:u,first_name:d,last_name:j,email:x,type:p,change_field:m,change_from:b,change_to:g})=>{const n=(m||"").split(", ").filter(Boolean),o=(b||"").split(",").filter(Boolean),_=(g||"").split(",").filter(Boolean);return e.jsxs(i.Fragment,{children:[e.jsxs("tr",{className:O[p],children:[e.jsx("td",{children:(p=="updated",d)}),e.jsx("td",{children:(p=="updated",j)}),e.jsx("td",{children:(p=="updated",x)}),e.jsx("td",{children:p}),e.jsx("td",{children:n[0]||""}),e.jsx("td",{children:o[0]||""}),e.jsx("td",{children:_[0]||""})]}),p==="updated"&&n.slice(1).map((v,y)=>e.jsxs("tr",{className:O[p],children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:v}),e.jsx("td",{children:o[y+1]||""}),e.jsx("td",{children:_[y+1]||""})]},`${u}-${v}`))]},u)})})]}):e.jsx("div",{children:"Data not found for that range."})}function Qe(){const[t,r]=i.useState([]),[c,s]=i.useState([]),[a,l]=i.useState([]),[h,u]=i.useState(!0),[d,j]=i.useState(!1),[x,p]=i.useState(!0);function m(){const n=new Date,o=new Date(n);o.setDate(n.getDate()-7);const _=D=>D.toISOString().split("T")[0],v=_(n),y=_(o);r([y,v]),console.log("in setDefaultDates:",[y,v])}i.useEffect(()=>{m(),g()},[]),i.useEffect(()=>{t.length===2&&(b(),console.log("Dates",t))},[t]);async function b(){console.log("in fetchMembershipData:"),j(!1),p(!0);const n=v=>v instanceof Date?v.toISOString().split("T")[0]:v,o=n(t[0]),_=n(t[1]);try{const v=await fetch(`/api/membership-updates/${o}/${_}`);if(!v.ok){const D=await v.text();throw j(!0),new Error(`Server error ${v.status}: ${D}`)}const y=await v.json();l(y)}catch(v){console.error("Failed to fetch membership updates",v)}finally{p(!1)}}async function g(){u(!0);try{const _=(await(await fetch("/api/earliest_listdate/")).json()).earliest_date;console.log("earliest ",_);const D=(f=>f.toISOString().split("T")[0])(new Date);console.log("todayStr",D),s([_,D])}catch(n){console.error("Failed to fetch earliest date",n)}finally{u(!1)}}return e.jsx("main",{className:O.memberWeeklies,children:e.jsxs("section",{className:O.tableContainer,children:[e.jsxs("header",{children:[e.jsx("h2",{className:O.tableTitle,children:"Membership Changes"}),e.jsx(q,{datesRange:c,asideName:"chart",defaultDates:t,setDates:r})]}),d?e.jsx("p",{children:"Data not found for that date range. Try inputting a different range."}):x||h?e.jsx("p",{children:"Loading data..."}):e.jsx(Ke,{data:a})]})})}function Xe(){const[t,r]=i.useState(null),[c,s]=i.useState(null),[a,l]=i.useState(null),[h,u]=i.useState(!0);i.useEffect(()=>{(async()=>{let p=c;if(!p)try{p=(await E.post("api/validate-refresh-token/",{},{withCredentials:!0})).data.access,s(p)}catch(m){console.log("Token refresh failed:",m.response?.data||m.message)}if(p){const m=await He(p,a,l,s);r(m)}else r(!1);u(!1)})()},[]);const d=1e3*60*5,j=()=>{s(null),l(null),r(!1)};return h?e.jsx("div",{children:"Checking authentication..."}):e.jsxs(C.BrowserRouter,{children:[t&&e.jsx(Me,{}),e.jsxs(C.Routes,{children:[e.jsx(C.Route,{path:"/",element:e.jsx(C.Navigate,{to:"/app/search",replace:!0})}),e.jsx(C.Route,{path:"/app/search",element:e.jsx(T,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:j,children:e.jsx($,{children:e.jsx(Le,{})})})})}),e.jsx(C.Route,{path:"/app/statistics",element:e.jsx(T,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:j,children:e.jsx($,{children:e.jsx(Ee,{})})})})}),e.jsx(C.Route,{path:"/app/weeklies",element:e.jsx(T,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:j,children:e.jsx($,{children:e.jsx(Qe,{})})})})}),e.jsx(C.Route,{path:"/app/members/:memberId",element:e.jsx(T,{isValid:t,token:c,children:e.jsx(R,{timeout:d,onIdle:j,children:e.jsx($,{children:e.jsx(Ue,{})})})})}),e.jsx(C.Route,{path:"/app/logout",element:e.jsx(T,{isValid:t,token:c,children:e.jsx(Ye,{onLogoutSuccess:()=>r(!1)})})}),e.jsx(C.Route,{path:"/app/login",element:e.jsx(G,{onLoginSuccess:()=>r(!0),setAccessToken:s,setRefreshToken:l})}),e.jsx(C.Route,{path:"*",element:t?e.jsx(Ae,{}):e.jsx(C.Navigate,{to:"/app/login",replace:!0})})]})]})}Z.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(Xe,{})}));
