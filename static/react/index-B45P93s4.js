import{r as i,j as e,m as S,D as K,a as N,C as Q,b as X,c as $,_ as T,R as q,d as Z}from"./vendor-Fm9ckxW3.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function c(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=c(a);fetch(a.href,l)}})();const Y=i.createContext();function B({children:t}){const[r,c]=i.useState([]),[s,a]=i.useState(!0);return i.useEffect(()=>{async function l(){try{const m=await(await fetch("/api/data")).json();c(JSON.parse(m))}catch(h){console.error("Failed to fetch members",h)}finally{a(!1)}}l()},[]),e.jsx(Y.Provider,{value:{members:r,isLoading:s},children:t})}const ee="_memberCard_1uz18_1",te="_memberTitle_1uz18_13",se="_cardContainer_1uz18_23",ne="_memberCardFull_1uz18_63",E={memberCard:ee,memberTitle:te,cardContainer:se,memberCardFull:ne};function re({memberId:t,fields:r}){return e.jsxs("div",{className:E.memberCard,children:[e.jsxs(S.Link,{to:`/app/members/${t}`,state:{memberFields:r},className:E.memberTitle,children:[e.jsxs("span",{children:[r.first_name," "]})," ",e.jsx("span",{children:r.last_name})," ",e.jsxs("span",{children:[" - ",r.membership_status]})]}),e.jsxs("div",{children:["Join date: ",r.join_date]}),e.jsxs("div",{children:["Expiry date: ",r.xdate]}),e.jsxs("div",{children:["Email: ",r.email]}),e.jsxs("div",{children:["Address: ",r.address1," ",r.address2,", ",r.city," ",r.state," ",r.vaccinated]})]})}const ae="_fullPage_7eejv_1",oe="_searchBar_7eejv_13",ie="_inactive_7eejv_33",ce="_active_7eejv_41",le="_buttonsContainer_7eejv_49",de="_toggleAdvancedSearch_7eejv_59",ue="_filterSideBar_7eejv_71",he="_content_7eejv_89",me="_membersList_7eejv_113",w={fullPage:ae,searchBar:oe,inactive:ie,active:ce,buttonsContainer:le,toggleAdvancedSearch:de,filterSideBar:ue,content:he,membersList:me};function fe({name:t,setQuery:r}){function c(s){return s==="address1"?"Address: ":s.charAt(0).toUpperCase()+s.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:w.filterField,children:[e.jsx("label",{children:`${c(t)}`}),e.jsx("input",{id:`adv_${t}`,type:"text",onChange:s=>r(t,s.target.value)})]})}function L({name:t,selectOptions:r=[],setQuery:c}){function s(a){return a==="student_yes_no"?"Student?: ":a.charAt(0).toUpperCase()+a.slice(1).replaceAll("_"," ")+": "}return e.jsxs("div",{className:w.filterField,children:[e.jsx("label",{children:`${s(t)}`}),e.jsx("select",{id:`adv_${t}`,name:`adv_${t}`,onChange:a=>c(t,a.target.value),children:r.map(a=>e.jsx("option",{value:a,children:a},`adv_${a}`))})]})}function V({name:t,setQuery:r,resetDates:c,defaultDate:s,datesRange:a}){const[l,h]=i.useState(s||new Date),[m,d]=i.useState([]),[f,j]=i.useState(!1);function x(o){return o==="xdate_before"?"Membership expires before: ":o=="xdate_after"?"Membership expires after: ":o==="join_date_after"?"Joined after: ":o==="join_date_before"?"Joined before: ":o.charAt(0).toUpperCase()+o.slice(1).replaceAll("_"," ")+": "}function _(o,g){h(g),r(o,g),j(!0)}i.useEffect(()=>{h(new Date),j(!1)},[c]),i.useEffect(()=>{m.length===0&&a!==void 0&&d(v(a))},[a]);function v(o){return o.map(g=>typeof g=="string"?p(g):g)}function p(o){return new Date(o.replace("-","/"))}i.useEffect(()=>{if(s){let o=s;typeof s=="string"&&(o=p(o),_(t,o)),h(o)}},[s]);function n(){j(!0)}return e.jsxs("div",{children:[e.jsx("label",{children:`${x(t)}`}),e.jsx(K,{className:f?w.active:w.inactive,selected:l,onChange:o=>_(t,o),onCalendarOpen:n,includeDateIntervals:a?[{start:m[0],end:m[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const pe="_redButton_ta6ja_101",je="_whiteButton_ta6ja_119",O={redButton:pe,whiteButton:je};function xe({setStateParameters:t,isVisible:r}){const[c,s]=i.useState({}),[a,l]=i.useState(!1),h=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],m=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],d=["join_date_before","join_date_after","xdate_before","xdate_after"],f=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],j=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],x=["","Member","Member in Good Standing","Lapsed"];function _(n,o){o=o.toString().toLowerCase(),n==="union_member"&&(o=o==="true"?"yes":"no"),s(g=>({...g,[n]:o}))}function v(n){n.preventDefault(),t(c)}function p(){document.querySelector("#advancedFilterForm").reset(),s({}),t({}),l(n=>!n)}return e.jsx("aside",{className:w.filterSideBar,children:r&&e.jsxs("form",{id:"advancedFilterForm",style:{display:r?"block":"none"},onSubmit:n=>v(n),children:[h.map(n=>m.includes(n)?e.jsx(fe,{name:n,setQuery:_},`component_${n}`):f.includes(n)?e.jsx(L,{name:n,selectOptions:["","True","False"],setQuery:_},`component_${n}`):d.includes(n)?e.jsx(V,{name:n,setQuery:_,resetDates:a,setResetDates:l},`component_${n}_${a}`):n==="membership_status"?e.jsx(L,{name:n,selectOptions:x,setQuery:_},`component_${n}`):n==="student_yes_no"?e.jsx(L,{name:n,selectOptions:["","Yes","No"],setQuery:_},`component_${n}`):n==="mailing_pref"?e.jsx(L,{name:n,selectOptions:["","Yes","No"],setQuery:_},`component_${n}`):n==="state"?e.jsx(L,{name:n,selectOptions:j,setQuery:_},`component_${n}`):console.log("unrecognized field; how'd you manage this?")),e.jsxs("div",{className:w.buttonsContainer,children:[e.jsx("button",{onClick:v,className:O.redButton,children:"Search"}),e.jsx("button",{onClick:p,className:O.whiteButton,children:"Clear filters"})]})]})})}const _e="_Search_6hey7_1",ge="_searchForm_6hey7_9",be="_searchButton_6hey7_19",R={Search:_e,searchForm:ge,searchButton:be};function ve({setStateParameters:t,query:r,setQuery:c,setReRender:s,reRender:a}){function l(h){h.preventDefault();const m={};if(t({}),r.includes(":")){const d=r.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(d);for(let f=0;f<d.length-1;f+=2){const j=d[f],x=d[f+1];m[j]=x}t(m)}s(!a)}return e.jsxs("form",{className:R.searchForm,onSubmit:h=>l(h),children:[e.jsx("input",{value:r,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:h=>c(h.target.value),type:"text",className:R.Search}),e.jsx("button",{className:`${O.redButton} ${R.searchButton}`,children:"Go!"})]})}function ye({MemberList:t=[]}){const[r,c]=i.useState(""),[s,a]=i.useState({}),[l,h]=i.useState(!1),[m,d]=i.useState(!1),f=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],j=()=>{d(p=>!p)},x=t.filter(p=>{const n=p.fields;let o={...s};const g=Object.keys(o).length;if(!g&&r!==""){for(const b in n){const y=n[b];if(y&&y.toString().toLowerCase().includes(r.toLowerCase()))return!0}return!1}else{if(!g&&r==="")return!0;if(g>0){if(f.some(({before:y,after:u})=>y in o||u in o)&&!v(n,o)||o.address1&&!_(n,o))return!1;for(const y of Object.keys(o)){const u=o[y];if(!(n[y]!==null?n[y].toString().toLowerCase():"").includes(u))return!1}return!0}}});function _(p,n){return!!(p.address1.includes(n.address1)||p.address2.includes(n.address1))}function v(p,n){let o=!0;for(const{base:g,before:b,after:y}of f){const u=n[b],C=n[y];u&&C?o=o&&N(p[g]).isBetween(n[y],n[b]):u?o=o&&N(p[g]).isBefore(n[b]):C&&(o=o&&N(p[g]).isAfter(n[y])),u&&delete n[b],C&&delete n[y]}return o}return e.jsxs("div",{className:w.fullPage,children:[e.jsxs("header",{className:w.searchBar,children:[e.jsx(ve,{setStateParameters:a,query:r,setQuery:c,setReRender:h,reRender:l}),e.jsxs("a",{className:w.toggleAdvancedSearch,onClick:j,children:[m?"Close":"Open"," advanced search"]})]}),e.jsxs("div",{className:w.content,children:[e.jsx(xe,{setStateParameters:a,isVisible:m}),e.jsx("main",{className:w.membersList,children:x.length>0?x.map(p=>e.jsx(re,{memberId:p.pk,fields:p.fields},p.pk)):e.jsx("li",{children:"No results found"})},l)]})]})}const Ce="_logoHeader_1iozh_1",Se={logoHeader:Ce},De="/static/react/headerlogo-400x400-vDrkEIdg.png";function J(){return e.jsxs("header",{className:Se.logoHeader,children:[e.jsx("img",{src:De}),e.jsxs("h2",{children:["DSA ",e.jsx("br",{}),"Membership",e.jsx("br",{}),"Visualizer"]})]})}const we="_navBar_1cdgm_1",Ne="_pageOptions_1cdgm_27",z={navBar:we,pageOptions:Ne};function Me(){return e.jsxs("nav",{className:z.navBar,children:[e.jsx(J,{}),e.jsxs("div",{className:z.pageOptions,children:[e.jsx("a",{href:"/admin/",children:"Admin"}),e.jsx(S.Link,{to:"/app/search",children:"Search"}),e.jsx(S.Link,{to:"/app/statistics",children:"Statistics"}),e.jsx(S.Link,{to:"/app/weeklies",children:"Membership Changes"}),e.jsx(S.Link,{to:"/app/logout",children:"Log out"})]})]})}function Fe(){const{members:t,isLoading:r}=i.useContext(Y);return r?e.jsx("p",{children:"Loading members..."}):e.jsx("div",{className:"MembersList",children:e.jsx(ye,{MemberList:t})})}function Ae(){return e.jsxs("div",{children:["Page not found. Have you forgotten to log in to the ",e.jsx("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function U({data:t,type:r}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function s(a){const l=a[0].slice(1);let h=a[1],m=a[a.length-1],d=[h,m];const j=[["Metric",...[h[0],m[0]],"% Change"]];return l.forEach((x,_)=>{const v=d.map(C=>C[_+1]),p=v[0],n=v[v.length-1],o=p!==0?(n-p)/Math.abs(p)*100:0,g=o>0?"⬆️":o<0?"⬇️":"—",b=o<0?"red":o>0?"green":"black",y=`${g} <span style="color:${b};">${o.toFixed(2)}%</span>`,u=[x,...v,y];j.push(u)}),j}return!t||!Array.isArray(t)||t.length===0||t[0].length===0?e.jsx("p",{children:"Loading chart data..."}):e.jsx(Q,{chartType:r,data:r==="Table"?s(t):t,options:c,legendToggle:!0})}const Le="_chartContainer_1rjw7_1",ke="_numbersAside_1rjw7_17",Oe="_chartForm_1rjw7_29",Te="_chartAside_1rjw7_61",Be="_statistics_1rjw7_81",$e="_asideContainer_1rjw7_119",M={chartContainer:Le,numbersAside:ke,chartForm:Oe,chartAside:Te,statistics:Be,asideContainer:$e};function G({asideName:t,datesRange:r,defaultDates:c,setDates:s}){const[a,l]=i.useState({});function h(d,f){l(j=>({...j,[d]:f}))}function m(d){d.preventDefault(),s(Object.values(a))}return e.jsxs("form",{className:M.chartForm,children:[e.jsx(V,{name:`${t}_from`,setQuery:h,defaultDate:c[0],datesRange:r}),e.jsx(V,{name:`${t}_to`,setQuery:h,defaultDate:c[1],datesRange:r})," ",e.jsx("button",{className:O.redButton,onClick:d=>m(d),children:"Go!"})]})}function Ee(){const[t,r]=i.useState(null),[c,s]=i.useState(null),[a,l]=i.useState(null),[h,m]=i.useState(!0),[d,f]=i.useState([]),[j,x]=i.useState([]),[_,v]=i.useState([]),[p,n]=i.useState([]),o=[];i.useEffect(()=>{async function u(){try{const D=await(await fetch("/api/membership_counts/")).json();r(D)}catch(C){console.error("Failed to fetch membershipCount",C)}finally{m(!1)}}u()},[]);function g(u){if(u.splice(2,1),u.splice(0,1),typeof u[1]=="string")for(let C=0;C<u.length;C++)u[C]=u[C].charAt(0).toUpperCase()+u[C].slice(1).replaceAll("_"," ");return u}function b(u){var C=u,D=C.sort(function(A,F){return Date.parse(A)>Date.parse(F)});n([D[0],D[D.length-1]])}i.useEffect(()=>{if(t){let u=Object.keys(t[0]),C=[];u=g(u),o.push(u);for(const D of t)C.push(D.list_date),u=Object.values(D),u=g(u),o.push(u);s(o),l(o),b(C)}},[t]),i.useEffect(()=>{p&&c&&y(p)},[p]);function y(u){if(!u||Object.keys(u).length!==2||!c)return;const C=N(u[0]).format("YYYY-MM-DD"),D=N(u[1]).format("YYYY-MM-DD");let A=[c[0]];for(let F=1;F<c.length;F++){const I=N(c[F][0]).format("YYYY-MM-DD");(N(I).isBetween(C,D)||N(I).isSame(C)||N(I).isSame(D))&&A.push(c[F])}l(A),f(A)}return t?h?e.jsx("p",{children:"Loading statistics..."}):e.jsxs("main",{className:M.statistics,children:[e.jsx(G,{datesRange:p,defaultDates:p,asideName:"chart",setDates:n}),e.jsxs("div",{className:M.asideContainer,children:[e.jsxs("aside",{className:M.numbersAside,children:[e.jsx("h2",{children:"Percent Change Over Time"}),e.jsx("div",{className:M.chartContainer,children:e.jsx(U,{data:d,type:"Table"})})]}),e.jsxs("aside",{className:M.chartAside,children:[e.jsx("h2",{children:"Area Chart of Membership Trends"}),e.jsx("div",{className:M.chartContainer,children:e.jsx(U,{data:a,type:"AreaChart"})})]})]})]}):e.jsx("p",{children:"Membership statistics not found."})}const Ie="_error_1tgho_29",Re="_loginPage_1tgho_45",Pe="_loginContainer_1tgho_61",P={error:Ie,loginPage:Re,loginContainer:Pe};function W({onLoginSuccess:t,setAccessToken:r,setRefreshToken:c}){const[s,a]=i.useState(""),[l,h]=i.useState(""),[m,d]=i.useState(""),f=S.useNavigate(),j=X.get("csrftoken"),x=async _=>{_.preventDefault();try{const v=await $.post("/api/login/",{username:s,password:l},{headers:{"X-CSRFToken":j},withCredentials:!0});d(null),r(v.data.access),c(v.data.refresh),f("/app/search"),t(),console.log("navigating")}catch(v){console.error("Login failed:",v);const p=v?.data?.error||v?.data?.detail||v?.message||v?.data||"Login failed due to an unknown error.";d(p)}};return e.jsx("main",{className:P.loginPage,children:e.jsxs("form",{className:P.loginContainer,onSubmit:x,children:[e.jsxs("div",{className:P.error,style:{display:m?"block":"none"},children:["Error: ",m+"."]}),e.jsx(J,{}),e.jsx("label",{htmlFor:"username",children:"Username: "}),e.jsx("input",{htmlFor:"username",type:"username",onChange:_=>a(_.target.value)}),e.jsx("label",{htmlFor:"password",children:"Password: "}),e.jsx("input",{htmlFor:"password",type:"password",onChange:_=>h(_.target.value)}),e.jsx("button",{className:O.redButton,children:"Log in"})]})})}function Ve({onLogoutSuccess:t}){return t(),e.jsx(W,{})}function Ye(){const{memberId:t}=S.useParams(),{members:r,isLoading:c}=i.useContext(Y),[s,a]=i.useState(null),[l,h]=i.useState(!1);return i.useEffect(()=>{const m=r.find(d=>d.pk.toString()===t);if(m)a(m);else{async function d(){h(!0);try{const j=await(await fetch(`/api/${t}/data`)).json();a(JSON.parse(j))}catch(f){console.error("Failed to fetch member data",f)}finally{h(!1)}}d()}},[t,r]),c||l?e.jsx("p",{children:"Loading member details..."}):s?e.jsx("div",{className:E.cardContainer,children:e.jsxs("div",{className:E.memberCardFull,children:[e.jsxs("h1",{children:[s.fields.first_name," ",s.fields.last_name]}),e.jsxs("section",{for:"committees_and_unions",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Committee:"}),s.fields.committee.length===0?" N/A":s.fields.committee]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union member:"})," ",s.fields.union_member]}),s.fields.union_name===""?e.jsx("span",{}):e.jsxs("p",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Union name:"})," ",s.fields.union_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Union local?:"})," ",s.fields.union_local]})]})]}),e.jsxs("section",{for:"contact",children:[e.jsx("h2",{children:"Contact information"}),e.jsxs("div",{children:[e.jsx("b",{children:"Best phone number:"})," ",s.fields.best_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile phone:"})," ",s.fields.mobile_phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.fields.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord:"})," ",s.fields.discord_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Discord status:"})," ",s.fields.discord_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mailing address:"})," ",s.fields.address1,","," ",s.fields.city," ",s.fields.zip,", ",s.fields.country]})]}),e.jsxs("section",{for:"membership_info",children:[e.jsx("h2",{children:"Membership"}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",s.fields.membership_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"DSA Chapter:"})," ",s.fields.dsa_chapter]}),e.jsxs("div",{children:[e.jsx("b",{children:"Membership type:"})," ",s.fields.membership_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Joined in the past month?:"}),s.fields.new_member_past_month]}),e.jsxs("div",{children:[e.jsx("b",{children:"Monthly dues status:"})," ",s.fields.monthly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Yearly dues status:"})," ",s.fields.yearly_dues_status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Join Date:"})," ",s.fields.join_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Expiry Date:"})," ",s.fields.xdate]})]})]})}):e.jsx("p",{children:"Member not found."})}const ze=async(t,r,c,s)=>{try{const a=await $.get("/api/validate-token/",{headers:{Authorization:`Bearer ${t}`},withCredentials:!1});return!0}catch(a){if(a.response?.status===401&&s)try{const l=await $.post("api/validate-refresh-token/",{refresh:r},{withCredentials:!1});return c(l.data.access),!0}catch{return!1}}},k=({children:t,isValid:r,token:c})=>!c||!r?(c||console.log("no token found"),r||console.log("invalid token"),e.jsx(S.Navigate,{to:"/app/login",replace:!0})):t,Ue="_updated_k63vv_7",He="_deleted_k63vv_15",H={new:"_new_k63vv_1",updated:Ue,deleted:He};function Je({data:t}){const{new_values:r,updated_values:c,deleted_values:s}=t,a=(m,d)=>Object.entries(m).map(([f,j])=>{const x=d==="updated"?j.current_values:j;return{id:f,first_name:x.first_name,last_name:x.last_name,email:x.email,change_field:d==="updated"?Object.keys(j.updated_values).join(", "):"",change_from:d==="updated"?Object.values(j.updated_values).map(([_,v])=>v).join(","):"",change_to:d==="updated"?Object.values(j.updated_values).map(([_])=>_).join(","):"",type:d}}),l=[...a(r,"new"),...a(c,"updated"),...a(s,"deleted")];console.log(l);const h=l.map(m=>{const d={};for(const[f,j]of Object.entries(m))d[f]=j===void 0?"":j;return d});return t?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Last Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Change Type"}),e.jsx("th",{children:"Change Field"}),e.jsx("th",{children:"Change From"}),e.jsx("th",{children:"Change To"})]})}),e.jsx("tbody",{children:h.map(({id:m,first_name:d,last_name:f,email:j,type:x,change_field:_,change_from:v,change_to:p})=>{const n=(_||"").split(", ").filter(Boolean),o=(v||"").split(",").filter(Boolean),g=(p||"").split(",").filter(Boolean);return e.jsxs(i.Fragment,{children:[e.jsxs("tr",{className:H[x],children:[e.jsx("td",{children:(x=="updated",d)}),e.jsx("td",{children:(x=="updated",f)}),e.jsx("td",{children:(x=="updated",j)}),e.jsx("td",{children:x}),e.jsx("td",{children:n[0]||""}),e.jsx("td",{children:o[0]||""}),e.jsx("td",{children:g[0]||""})]}),x==="updated"&&n.slice(1).map((b,y)=>e.jsxs("tr",{className:H[x],children:[e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:b}),e.jsx("td",{children:o[y+1]||""}),e.jsx("td",{children:g[y+1]||""})]},`${m}-${b}`))]},m)})})]}):e.jsx("div",{children:"Data not found for that range."})}function Ge(){const[t,r]=i.useState([]),[c,s]=i.useState([]),[a,l]=i.useState([]),[h,m]=i.useState(!0),[d,f]=i.useState(!1),[j,x]=i.useState(!0);function _(){const n=new Date,o=new Date(n);o.setDate(n.getDate()-7);const g=u=>u.toISOString().split("T")[0],b=g(n),y=g(o);r([y,b]),console.log("in setDefaultDates:",[y,b])}i.useEffect(()=>{_(),p()},[]),i.useEffect(()=>{t.length===2&&(v(),console.log("Dates",t))},[t]),i.useEffect(()=>{},[t]);async function v(){console.log("in fetchMembershipData:"),f(!1),x(!0);const n=b=>b instanceof Date?b.toISOString().split("T")[0]:b,o=n(t[0]),g=n(t[1]);try{const b=await fetch(`/api/membership-updates/${o}/${g}`);if(!b.ok){const u=await b.text();throw f(!0),new Error(`Server error ${b.status}: ${u}`)}const y=await b.json();l(y)}catch(b){console.error("Failed to fetch membership updates",b)}finally{x(!1)}}async function p(){m(!0);try{const g=(await(await fetch("/api/earliest_listdate/")).json()).earliest_date;console.log("earliest ",g);const u=(C=>C.toISOString().split("T")[0])(new Date);console.log("todayStr",u),s([g,u])}catch(n){console.error("Failed to fetch earliest date",n)}finally{m(!1)}}return e.jsxs("div",{children:[e.jsx(G,{datesRange:c,asideName:"chart",defaultDates:t,setDates:r}),d?e.jsx("p",{children:"Data not found for that date range. Try inputting a different range."}):j||h?e.jsx("p",{children:"Loading data..."}):e.jsx(Je,{data:a})]})}function We(){const[t,r]=i.useState(null),[c,s]=i.useState(null),[a,l]=i.useState(null),[h,m]=i.useState(!0);i.useEffect(()=>{(async()=>{let x=c;if(!x)try{x=(await $.post("api/validate-refresh-token/",{},{withCredentials:!0})).data.access,s(x)}catch(_){console.log("Token refresh failed:",_.response?.data||_.message)}if(x){const _=await ze(x,a,l,s);r(_)}else r(!1);m(!1)})()},[]);const d=1e3*60*5,f=()=>{s(null),l(null),r(!1)};return h?e.jsx("div",{children:"Checking authentication..."}):e.jsxs(S.BrowserRouter,{children:[t&&e.jsx(Me,{}),e.jsxs(S.Routes,{children:[e.jsx(S.Route,{path:"/",element:e.jsx(S.Navigate,{to:"/app/search",replace:!0})}),e.jsx(S.Route,{path:"/app/search",element:e.jsx(k,{isValid:t,token:c,children:e.jsx(T,{timeout:d,onIdle:f,children:e.jsx(B,{children:e.jsx(Fe,{})})})})}),e.jsx(S.Route,{path:"/app/statistics",element:e.jsx(k,{isValid:t,token:c,children:e.jsx(T,{timeout:d,onIdle:f,children:e.jsx(B,{children:e.jsx(Ee,{})})})})}),e.jsx(S.Route,{path:"/app/weeklies",element:e.jsx(k,{isValid:t,token:c,children:e.jsx(T,{timeout:d,onIdle:f,children:e.jsx(B,{children:e.jsx(Ge,{})})})})}),e.jsx(S.Route,{path:"/app/members/:memberId",element:e.jsx(k,{isValid:t,token:c,children:e.jsx(T,{timeout:d,onIdle:f,children:e.jsx(B,{children:e.jsx(Ye,{})})})})}),e.jsx(S.Route,{path:"/app/logout",element:e.jsx(k,{isValid:t,token:c,children:e.jsx(Ve,{onLogoutSuccess:()=>r(!1)})})}),e.jsx(S.Route,{path:"/app/login",element:e.jsx(W,{onLoginSuccess:()=>r(!0),setAccessToken:s,setRefreshToken:l})}),e.jsx(S.Route,{path:"*",element:t?e.jsx(Ae,{}):e.jsx(S.Navigate,{to:"/app/login",replace:!0})})]})]})}q.createRoot(document.getElementById("root")).render(e.jsx(Z.StrictMode,{children:e.jsx(We,{})}));
