import{j as E,r as d,m as S,D as G,a as M,C as K,b as P,c as W,R as Q}from"./vendor-8dbdfeb8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function c(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=c(o);fetch(o.href,l)}})();const q=E.Fragment,e=E.jsx,r=E.jsxs,T=d.createContext();function X({children:n}){const[t,c]=d.useState([]),[s,o]=d.useState(!0);return d.useEffect(()=>{async function l(){try{const f=await(await fetch("/api/data")).json();c(JSON.parse(f))}catch(u){console.error("Failed to fetch members",u)}finally{o(!1)}}l()},[]),e(T.Provider,{value:{members:t,isLoading:s},children:n})}const Z="_memberCard_1oasd_1",ee="_memberTitle_1oasd_13",V={memberCard:Z,memberTitle:ee};function te({memberId:n,fields:t}){return r("div",{className:V.memberCard,children:[r(S.Link,{to:`/members/${n}`,state:{memberFields:t},className:V.memberTitle,children:[r("span",{children:[t.first_name," "]})," ",e("span",{children:t.last_name})," ",r("span",{children:[" - ",t.membership_status]})]}),r("div",{children:["Join date: ",t.join_date]}),r("div",{children:["Expiry date: ",t.xdate]}),r("div",{children:["Email: ",t.email]}),r("div",{children:["Address: ",t.address1," ",t.address2,", ",t.city," ",t.state," ",t.vaccinated]})]})}const ne="_fullPage_7eejv_1",se="_searchBar_7eejv_13",re="_inactive_7eejv_33",ae="_active_7eejv_41",oe="_buttonsContainer_7eejv_49",ie="_toggleAdvancedSearch_7eejv_59",ce="_filterSideBar_7eejv_71",le="_content_7eejv_89",de="_membersList_7eejv_113",ue="_hidden_7eejv_127",L={fullPage:ne,searchBar:se,inactive:re,active:ae,buttonsContainer:oe,toggleAdvancedSearch:ie,filterSideBar:ce,content:le,membersList:de,hidden:ue};function he({name:n,setQuery:t}){function c(s){return s==="address1"?"Address: ":s.charAt(0).toUpperCase()+s.slice(1).replaceAll("_"," ")+": "}return r("div",{className:L.filterField,children:[e("label",{children:`${c(n)}`}),e("input",{id:`adv_${n}`,type:"text",onChange:s=>t(n,s.target.value)})]})}function j({name:n,selectOptions:t=[],setQuery:c}){function s(o){return o==="student_yes_no"?"Student?: ":o.charAt(0).toUpperCase()+o.slice(1).replaceAll("_"," ")+": "}return r("div",{className:L.filterField,children:[e("label",{children:`${s(n)}`}),e("select",{id:`adv_${n}`,name:`adv_${n}`,onChange:o=>c(n,o.target.value),children:t.map(o=>e("option",{value:o,children:o},`adv_${o}`))})]})}function I({name:n,setQuery:t,resetDates:c,defaultDate:s,datesRange:o}){const[l,u]=d.useState(s||new Date),[f,g]=d.useState([]),[p,b]=d.useState(!1);function D(i){return i==="xdate_before"?"Membership expires before: ":i=="xdate_after"?"Membership expires after: ":i==="join_date_after"?"Joined after: ":i==="join_date_before"?"Joined before: ":i.charAt(0).toUpperCase()+i.slice(1).replaceAll("_"," ")+": "}function C(i,y){u(y),t(i,y),b(!0)}d.useEffect(()=>{u(new Date),b(!1)},[c]),d.useEffect(()=>{f.length===0&&o!==void 0&&g(N(o))},[o]);function N(i){return i.map(y=>typeof y=="string"?_(y):y)}function _(i){return new Date(i.replace("-","/"))}d.useEffect(()=>{if(s){let i=s;typeof s=="string"&&(i=_(i),C(n,i)),u(i)}},[s]);function a(){b(!0)}return r("div",{children:[e("label",{children:`${D(n)}`}),e(G,{className:p?L.active:L.inactive,selected:l,onChange:i=>C(n,i),onCalendarOpen:a,includeDateIntervals:o?[{start:f[0],end:f[1]}]:[{start:new Date(70,0,1),end:new Date}]})]})}const me="_redButton_ta6ja_101",fe="_whiteButton_ta6ja_119",x={redButton:me,whiteButton:fe};function _e({setStateParameters:n,isVisible:t}){const[c,s]=d.useState({}),[o,l]=d.useState(!1),u=["first_name","last_name","email","do_not_call","best_phone","join_date_after","join_date_before","xdate_after","xdate_before","membership_status","union_member","union_name","student_yes_no","student_school_name","mailing_pref","address1","city","state","zip","new_member_past_month","discord_name","discord_status","vaccinated","do_not_text","do_not_email","in_chapter"],f=["first_name","last_name","email","best_phone","union_name","student_school_name","address1","city","zip","discord_name","discord_status"],g=["join_date_before","join_date_after","xdate_before","xdate_after"],p=["do_not_call","union_member","new_member_past_month","vaccinated","do_not_text","do_not_email","in_chapter"],b=["","MA","VT","NH","CT","RI","ME","AL","AK","AS","AZ","AR","CA","CO","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","MH","MD","MI","MN","MS","MO","MT","NE","NV","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","SC","SD","TN","TX","UT","VI","VA","WA","WV","WI","WY"],D=["","Member","Member in Good Standing","Lapsed"];function C(a,i){i=i.toString().toLowerCase(),a==="union_member"&&(i=i==="true"?"yes":"no"),s(y=>({...y,[a]:i}))}function N(a){a.preventDefault(),n(c)}function _(){document.querySelector("#advancedFilterForm").reset(),s({}),n({}),l(a=>!a)}return e("aside",{className:L.filterSideBar,children:t&&r("form",{id:"advancedFilterForm",style:{display:t?"block":"none"},onSubmit:a=>N(a),children:[u.map(a=>f.includes(a)?e(he,{name:a,setQuery:C},`component_${a}`):p.includes(a)?e(j,{name:a,selectOptions:["","True","False"],setQuery:C},`component_${a}`):g.includes(a)?e(I,{name:a,setQuery:C,resetDates:o,setResetDates:l},`component_${a}_${o}`):a==="membership_status"?e(j,{name:a,selectOptions:D,setQuery:C},`component_${a}`):a==="student_yes_no"?e(j,{name:a,selectOptions:["","Yes","No"],setQuery:C},`component_${a}`):a==="mailing_pref"?e(j,{name:a,selectOptions:["","Yes","No"],setQuery:C},`component_${a}`):a==="state"?e(j,{name:a,selectOptions:b,setQuery:C},`component_${a}`):console.log("unrecognized field; how'd you manage this?")),r("div",{className:L.buttonsContainer,children:[e("button",{onClick:N,className:x.redButton,children:"Search"}),e("button",{onClick:_,className:x.whiteButton,children:"Clear filters"})]})]})})}const pe="_Search_6hey7_1",ge="_searchForm_6hey7_9",be="_searchButton_6hey7_19",O={Search:pe,searchForm:ge,searchButton:be};function ve({setStateParameters:n,query:t,setQuery:c,setReRender:s,reRender:o}){function l(u){u.preventDefault();const f={};if(n({}),t.includes(":")){const g=t.toLowerCase().match(/(?:[^\s:"']+|['"][^'"]*["'])+/g);console.log(g);for(let p=0;p<g.length-1;p+=2){const b=g[p],D=g[p+1];f[b]=D}n(f)}s(!o)}return r("form",{className:O.searchForm,onSubmit:u=>l(u),children:[e("input",{value:t,placeholder:"first_name:Anton last_name:Faulkner new_member_past_month:true",onChange:u=>c(u.target.value),type:"text",className:O.Search}),e("button",{className:`${x.redButton} ${O.searchButton}`,children:"Go!"})]})}function ye({MemberList:n=[]}){const[t,c]=d.useState(""),[s,o]=d.useState({}),[l,u]=d.useState(!1),[f,g]=d.useState(!1),p=[{base:"join_date",before:"join_date_before",after:"join_date_after"},{base:"xdate",before:"xdate_before",after:"xdate_after"}],b=()=>{g(_=>!_)},D=n.filter(_=>{const a=_.fields;let i={...s};const y=Object.keys(i).length;if(!y&&t!==""){for(const h in a){const m=a[h];if(m&&m.toString().toLowerCase().includes(t.toLowerCase()))return!0}return!1}else{if(!y&&t==="")return!0;if(y>0){if(p.some(({before:m,after:v})=>m in i||v in i)&&!N(a,i)||i.address1&&!C(a,i))return!1;for(const m of Object.keys(i)){const v=i[m];if(!(a[m]!==null?a[m].toString().toLowerCase():"").includes(v))return!1}return!0}}});function C(_,a){return!!(_.address1.includes(a.address1)||_.address2.includes(a.address1))}function N(_,a){let i=!0;for(const{base:y,before:h,after:m}of p){const v=a[h],A=a[m];v&&A?i=i&&M(_[y]).isBetween(a[m],a[h]):v?i=i&&M(_[y]).isBefore(a[h]):A&&(i=i&&M(_[y]).isAfter(a[m])),v&&delete a[h],A&&delete a[m]}return i}return r("div",{className:L.fullPage,children:[r("header",{className:L.searchBar,children:[e(ve,{setStateParameters:o,query:t,setQuery:c,setReRender:u,reRender:l}),r("a",{className:L.toggleAdvancedSearch,onClick:b,children:[f?"Close":"Open"," advanced search"]})]}),r("div",{className:L.content,children:[e(_e,{setStateParameters:o,isVisible:f}),e("main",{className:L.membersList,children:D.length>0?D.map(_=>e(te,{memberId:_.pk,fields:_.fields},_.pk)):e("li",{children:"No results found"})},l)]})]})}const Se="_logoHeader_1iozh_1",Ce={logoHeader:Se},De="/static/react/headerlogo-400x400-4e71439a.png";function z(){return r("header",{className:Ce.logoHeader,children:[e("img",{src:De}),r("h2",{children:["DSA ",e("br",{}),"Membership",e("br",{}),"Visualizer"]})]})}const Ne="_navBar_1cdgm_1",Ae="_pageOptions_1cdgm_27",Y={navBar:Ne,pageOptions:Ae};function Le(){return r("nav",{className:Y.navBar,children:[e(z,{}),r("div",{className:Y.pageOptions,children:[e("a",{href:"/admin/",children:"Admin"}),e(S.Link,{to:"/app/search",children:"Search"}),e(S.Link,{to:"/app/statistics",children:"Statistics"}),e(S.Link,{to:"/app/logout",children:"Log out"})]})]})}function Me(){const{members:n,isLoading:t}=d.useContext(T);return t?e("p",{children:"Loading members..."}):e("div",{className:"MembersList",children:e(ye,{MemberList:n})})}function Fe(){return r("div",{children:["Page not found. Have you forgotten to log in to the ",e("a",{href:"https://membership-visualizer-f89b37f434b7.herokuapp.com/admin/",children:"back-end?"})]})}function H({data:n,type:t}){const c={title:"Chapter Membership Statistics",allowHtml:!0,vAxis:{minValue:0},chartArea:{left:"5%",width:"75%",height:"80%"},height:"55vh",width:"95%",legend:{position:"right"}};function s(o){const l=o[0].slice(1);let u=o[1],f=o[o.length-1],g=[u,f];const b=[["Metric",...[u[0],f[0]],"% Change"]];return l.forEach((D,C)=>{const N=g.map(A=>A[C+1]),_=N[0],a=N[N.length-1],i=_!==0?(a-_)/Math.abs(_)*100:0,y=i>0?"⬆️":i<0?"⬇️":"—",h=i<0?"red":i>0?"green":"black",m=`${y} <span style="color:${h};">${i.toFixed(2)}%</span>`,v=[D,...N,m];b.push(v)}),b}return!n||!Array.isArray(n)||n.length===0||n[0].length===0?e("p",{children:"Loading chart data..."}):e(K,{chartType:t,data:t==="Table"?s(n):n,options:c,legendToggle:!0})}const we="_chartContainer_1m3i0_1",je="_numbersAside_1m3i0_17",ke="_chartForm_1m3i0_29",xe="_chartAside_1m3i0_57",Be="_statistics_1m3i0_77",$e="_inactive_1m3i0_129",Oe="_active_1m3i0_137",Re="_container_1m3i0_1",F={chartContainer:we,numbersAside:je,chartForm:ke,chartAside:xe,statistics:Be,inactive:$e,active:Oe,container:Re};function U({asideName:n,dates:t,setDates:c}){const[s,o]=d.useState({});function l(f,g){o(p=>({...p,[f]:g}))}function u(f){f.preventDefault(),c(Object.values(s))}return r("form",{className:F.chartForm,children:[e(I,{name:`${n}_from`,setQuery:l,defaultDate:t[0],datesRange:t}),e(I,{name:`${n}_to`,setQuery:l,defaultDate:t[1],datesRange:t})," ",e("button",{className:x.redButton,onClick:f=>u(f),children:"Go!"})]})}function Pe(){const[n,t]=d.useState(null),[c,s]=d.useState(null),[o,l]=d.useState(null),[u,f]=d.useState(!0),[g,p]=d.useState([]),[b,D]=d.useState([]),[C,N]=d.useState([]),_=[];d.useEffect(()=>{async function h(){try{const v=await(await fetch("/api/membership_counts/")).json();t(v)}catch(m){console.error("Failed to fetch membershipCount",m)}finally{f(!1)}}h()},[]);function a(h){if(h.splice(2,1),h.splice(0,1),typeof h[1]=="string")for(let m=0;m<h.length;m++)h[m]=h[m].charAt(0).toUpperCase()+h[m].slice(1).replaceAll("_"," ");return h}function i(h){var m=h,v=m.sort(function(A,w){return Date.parse(A)>Date.parse(w)});p([v[0],v[v.length-1]]),D([v[0],v[v.length-1]])}d.useEffect(()=>{if(n){let h=Object.keys(n[0]),m=[];h=a(h),_.push(h);for(const v of n)m.push(v.list_date),h=Object.values(v),h=a(h),_.push(h);s(_),l(_),i(m)}},[n]),d.useEffect(()=>{g&&c&&y(g,"chart")},[g]),d.useEffect(()=>{b&&c&&y(b,"table")},[b]);function y(h,m){if(!h||Object.keys(h).length!==2||!c)return;const v=M(h[0]).format("YYYY-MM-DD"),A=M(h[1]).format("YYYY-MM-DD");let w=[c[0]];for(let B=1;B<c.length;B++){const $=M(c[B][0]).format("YYYY-MM-DD");(M($).isBetween(v,A)||M($).isSame(v)||M($).isSame(A))&&w.push(c[B])}m==="chart"&&l(w),m==="table"&&N(w)}return n?u?e("p",{children:"Loading statistics..."}):r("main",{className:F.statistics,children:[r("aside",{className:F.numbersAside,children:[e("h2",{children:"Percent Change Over Time"}),r("div",{className:F.chartContainer,children:[e(U,{dates:b,asideName:"chart",setDates:D}),e(H,{data:C,type:"Table"})]})]}),r("aside",{className:F.chartAside,children:[e("h1",{children:"Area Chart of Membership Trends"}),r("div",{className:F.chartContainer,children:[e(U,{dates:g,asideName:"chart",setDates:p}),e(H,{data:o,type:"AreaChart"})]})]})]}):e("p",{children:"Membership statistics not found."})}const Ie="_root_1tgho_1",Ee="_inactive_1tgho_13",Te="_active_1tgho_21",Ve="_error_1tgho_29",Ye="_loginPage_1tgho_45",He="_loginContainer_1tgho_61",R={root:Ie,inactive:Ee,active:Te,error:Ve,loginPage:Ye,loginContainer:He};function J({onLoginSuccess:n}){const[t,c]=d.useState(""),[s,o]=d.useState(""),[l,u]=d.useState(""),f=S.useNavigate(),g=async p=>{p.preventDefault();try{const b=await P.post("/api/login/",{username:t,password:s});u(null),localStorage.setItem("token",b.data.access),f("/app/search"),n()}catch(b){console.error("Login failed:",b.response.data),P.defaults.headers.common.Authorization=null,u(b.response.data.error)}};return e("main",{className:R.loginPage,children:r("form",{className:R.loginContainer,onSubmit:g,children:[r("div",{className:R.error,style:{display:l?"block":"none"},children:["Error: ",l+"."]}),e(z,{}),e("label",{htmlFor:"username",children:"Username: "}),e("input",{htmlFor:"username",type:"username",onChange:p=>c(p.target.value)}),e("label",{htmlFor:"password",children:"Password: "}),e("input",{htmlFor:"password",type:"password",onChange:p=>o(p.target.value)}),e("button",{className:x.redButton,children:"Log in"})]})})}function Ue({onLogoutSuccess:n}){return localStorage.removeItem("token"),n(),e(J,{})}function ze(){const{memberId:n}=S.useParams(),{members:t,isLoading:c}=d.useContext(T),[s,o]=d.useState(null),[l,u]=d.useState(!1);return d.useEffect(()=>{const f=t.find(g=>g.pk.toString()===n);if(f)o(f);else{async function g(){u(!0);try{const b=await(await fetch(`/api/${n}/data`)).json();o(JSON.parse(b))}catch(p){console.error("Failed to fetch member data",p)}finally{u(!1)}}g()}},[n,t]),c||l?e("p",{children:"Loading member details..."}):s?r("div",{children:[r("h1",{children:[s.fields.first_name," ",s.fields.last_name]}),r("section",{for:"committees_and_unions",children:[r("div",{children:["Committee:",s.fields.committee.length===0?" N/A":s.fields.committee]}),r("div",{children:["Union member: ",s.fields.union_member]}),s.fields.union_name===""?e("div",{}):r("p",{children:[r("div",{children:["Union name: ",s.fields.union_name]}),r("div",{children:["Union local?: ",s.fields.union_local]})]})]}),r("section",{for:"contact",children:[e("h2",{children:"Contact information"}),r("div",{children:["Best phone number: ",s.fields.best_phone]}),r("div",{children:["Mobile phone: ",s.fields.mobile_phone]}),r("div",{children:["Email: ",s.fields.email]}),r("div",{children:["Discord: ",s.fields.discord_name," status:"," ",s.fields.discord_status]}),r("div",{children:["Mailing address: ",s.fields.address1,", ",s.fields.city," ",s.fields.zip,", ",s.fields.country]})]}),r("section",{for:"membership_info",children:[e("h2",{children:"Membership"}),r("div",{children:["Joined in the past month?: ",s.fields.new_member_past_month]}),r("div",{children:["DSA Chapter: ",s.fields.dsa_chapter]}),r("div",{children:["Membership type: ",s.fields.membership_type]}),r("div",{children:["Monthly dues status: ",s.fields.monthly_dues_status]}),r("div",{children:["Yearly dues status: ",s.fields.yearly_dues_status]}),r("div",{children:["Status: ",s.fields.membership_status]}),r("div",{children:["Join Date: ",s.fields.join_date]}),r("div",{children:["Expiry Date: ",s.fields.xdate]})]})]}):e("p",{children:"Member not found."})}const Je=async n=>{var t;try{const c=await P.get("/api/validate-token/",{headers:{Authorization:`Bearer ${n}`}});return console.log(c),!0}catch(c){return console.error("Invalid token:",((t=c.response)==null?void 0:t.data)||c.message),!1}},k=({children:n,isValid:t})=>{const c=localStorage.getItem("token");return!c||!t?(c||console.log("no token found"),t||console.log("invalid token"),e(S.Navigate,{to:"/login"})):n};function Ge(){const[n,t]=d.useState(null),[c,s]=d.useState(!0);return d.useEffect(()=>{(async()=>{const l=localStorage.getItem("token");if(l){const u=await Je(l);t(u),u||localStorage.removeItem("token")}else t(!1);s(!1)})()},[]),c?e("div",{children:"Checking authentication..."}):e(S.BrowserRouter,{children:n?r(q,{children:[e(Le,{}),e(X,{children:r(S.Routes,{children:[e(S.Route,{path:"/",element:e(S.Navigate,{to:"/app/search",replace:!0})}),e(S.Route,{path:"/app/search",element:e(k,{isValid:n,children:e(Me,{})})}),e(S.Route,{path:"/app/statistics",element:e(k,{isValid:n,children:e(Pe,{})})}),e(S.Route,{path:"/app/members/:memberId",element:e(k,{isValid:n,children:e(ze,{})})}),e(S.Route,{path:"/app/logout",element:e(k,{isValid:n,children:e(Ue,{onLogoutSuccess:()=>t(!1)})})}),e(S.Route,{path:"*",element:e(k,{isValid:n,children:e(Fe,{})})})]})})]}):r(S.Routes,{children:[e(S.Route,{path:"/app/login",element:e(J,{onLoginSuccess:()=>t(!0)})}),e(S.Route,{path:"*",element:e(S.Navigate,{to:"/app/login"})})]})})}W.createRoot(document.getElementById("root")).render(e(Q.StrictMode,{children:e(Ge,{})}));
